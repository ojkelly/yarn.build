/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-build",
factory: function (require) {
var plugin;(()=>{var t={102:(t,e,n)=>{const r=n(142),i=function(t,e){return new Promise((n,i)=>{r(t,e,(t,e)=>null===t?n(e):i(t))})};t.exports=i,t.exports.glob=r,t.exports.Glob=r.Glob,t.exports.hasMagic=r.hasMagic,t.exports.promise=i,t.exports.sync=r.sync},379:t=>{"use strict";t.exports=({onlyFirst:t=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,t?void 0:"g")}},891:(t,e,n)=>{"use strict";t=n.nmd(t);const r=(t,e)=>(...n)=>`[${t(...n)+e}m`,i=(t,e)=>(...n)=>{const r=t(...n);return`[${38+e};5;${r}m`},o=(t,e)=>(...n)=>{const r=t(...n);return`[${38+e};2;${r[0]};${r[1]};${r[2]}m`},s=t=>t,a=(t,e,n)=>[t,e,n],c=(t,e,n)=>{Object.defineProperty(t,e,{get:()=>{const r=n();return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0})};let u;const l=(t,e,r,i)=>{void 0===u&&(u=n(108));const o=i?10:0,s={};for(const[n,i]of Object.entries(u)){const a="ansi16"===n?"ansi":n;n===e?s[a]=t(r,o):"object"==typeof i&&(s[a]=t(i[e],o))}return s};Object.defineProperty(t,"exports",{enumerable:!0,get:function(){const t=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(const[n,r]of Object.entries(e)){for(const[n,i]of Object.entries(r))e[n]={open:`[${i[0]}m`,close:`[${i[1]}m`},r[n]=e[n],t.set(i[0],i[1]);Object.defineProperty(e,n,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:t,enumerable:!1}),e.color.close="[39m",e.bgColor.close="[49m",c(e.color,"ansi",()=>l(r,"ansi16",s,!1)),c(e.color,"ansi256",()=>l(i,"ansi256",s,!1)),c(e.color,"ansi16m",()=>l(o,"rgb",a,!1)),c(e.bgColor,"ansi",()=>l(r,"ansi16",s,!0)),c(e.bgColor,"ansi256",()=>l(i,"ansi256",s,!0)),c(e.bgColor,"ansi16m",()=>l(o,"rgb",a,!0)),e}})},598:t=>{"use strict";t.exports=t=>t&&t.exact?new RegExp("^[\ud800-\udbff][\udc00-\udfff]$"):new RegExp("[\ud800-\udbff][\udc00-\udfff]","g")},626:(t,e)=>{"use strict";class n{constructor(t){this.tasks=[],this.count=t}sched(){if(this.count>0&&this.tasks.length>0){this.count--;let t=this.tasks.shift();if(void 0===t)throw"Unexpected undefined value in tasks list";t()}}acquire(){return new Promise((t,e)=>{this.tasks.push(()=>{var e=!1;t(()=>{e||(e=!0,this.count++,this.sched())})}),process&&process.nextTick?process.nextTick(this.sched.bind(this)):setImmediate(this.sched.bind(this))})}use(t){return this.acquire().then(e=>t().then(t=>(e(),t)).catch(t=>{throw e(),t}))}}e.W=class extends n{constructor(){super(1)}}},543:t=>{"use strict";function e(t,e,i){t instanceof RegExp&&(t=n(t,i)),e instanceof RegExp&&(e=n(e,i));var o=r(t,e,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+t.length,o[1]),post:i.slice(o[1]+e.length)}}function n(t,e){var n=e.match(t);return n?n[0]:null}function r(t,e,n){var r,i,o,s,a,c=n.indexOf(t),u=n.indexOf(e,c+1),l=c;if(c>=0&&u>0){if(t===e)return[c,u];for(r=[],o=n.length;l>=0&&!a;)l==c?(r.push(l),c=n.indexOf(t,l+1)):1==r.length?a=[r.pop(),u]:((i=r.pop())<o&&(o=i,s=u),u=n.indexOf(e,l+1)),l=c<u&&c>=0?c:u;r.length&&(a=[o,s])}return a}t.exports=e,e.range=r},790:(t,e,n)=>{var r=n(345),i=n(543);t.exports=function(t){if(!t)return[];"{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2));return function t(e,n){var o=[],s=i("{","}",e);if(!s||/\$$/.test(s.pre))return[e];var c,u=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),h=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),m=u||h,v=s.body.indexOf(",")>=0;if(!m&&!v)return s.post.match(/,.*\}/)?(e=s.pre+"{"+s.body+a+s.post,t(e)):[e];if(m)c=s.body.split(/\.\./);else{if(1===(c=function t(e){if(!e)return[""];var n=[],r=i("{","}",e);if(!r)return e.split(",");var o=r.pre,s=r.body,a=r.post,c=o.split(",");c[c.length-1]+="{"+s+"}";var u=t(a);a.length&&(c[c.length-1]+=u.shift(),c.push.apply(c,u));return n.push.apply(n,c),n}(s.body)).length)if(1===(c=t(c[0],!1).map(p)).length)return(w=s.post.length?t(s.post,!1):[""]).map((function(t){return s.pre+c[0]+t}))}var y,b=s.pre,w=s.post.length?t(s.post,!1):[""];if(m){var k=l(c[0]),C=l(c[1]),_=Math.max(c[0].length,c[1].length),x=3==c.length?Math.abs(l(c[2])):1,E=f;C<k&&(x*=-1,E=g);var I=c.some(d);y=[];for(var R=k;E(R,C);R+=x){var S;if(h)"\\"===(S=String.fromCharCode(R))&&(S="");else if(S=String(R),I){var A=_-S.length;if(A>0){var O=new Array(A+1).join("0");S=R<0?"-"+O+S.slice(1):O+S}}y.push(S)}}else y=r(c,(function(e){return t(e,!1)}));for(var j=0;j<y.length;j++)for(var T=0;T<w.length;T++){var $=b+y[j]+w[T];(!n||m||$)&&o.push($)}return o}(function(t){return t.split("\\\\").join(o).split("\\{").join(s).split("\\}").join(a).split("\\,").join(c).split("\\.").join(u)}(t),!0).map(h)};var o="\0SLASH"+Math.random()+"\0",s="\0OPEN"+Math.random()+"\0",a="\0CLOSE"+Math.random()+"\0",c="\0COMMA"+Math.random()+"\0",u="\0PERIOD"+Math.random()+"\0";function l(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function h(t){return t.split(o).join("\\").split(s).join("{").split(a).join("}").split(c).join(",").split(u).join(".")}function p(t){return"{"+t+"}"}function d(t){return/^-?0\d/.test(t)}function f(t,e){return t<=e}function g(t,e){return t>=e}},168:(t,e,n)=>{"use strict";var r=n(715),i=process.env;function o(t){return"string"==typeof t?!!i[t]:Object.keys(t).every((function(e){return i[e]===t[e]}))}Object.defineProperty(e,"_vendors",{value:r.map((function(t){return t.constant}))}),e.name=null,e.isPR=null,r.forEach((function(t){var n=(Array.isArray(t.env)?t.env:[t.env]).every((function(t){return o(t)}));if(e[t.constant]=n,n)switch(e.name=t.name,typeof t.pr){case"string":e.isPR=!!i[t.pr];break;case"object":"env"in t.pr?e.isPR=t.pr.env in i&&i[t.pr.env]!==t.pr.ne:"any"in t.pr?e.isPR=t.pr.any.some((function(t){return!!i[t]})):e.isPR=o(t.pr);break;default:e.isPR=null}})),e.isCI=!!(i.CI||i.CONTINUOUS_INTEGRATION||i.BUILD_NUMBER||i.RUN_ID||e.name)},715:t=>{"use strict";t.exports=JSON.parse('[{"name":"AppVeyor","constant":"APPVEYOR","env":"APPVEYOR","pr":"APPVEYOR_PULL_REQUEST_NUMBER"},{"name":"Azure Pipelines","constant":"AZURE_PIPELINES","env":"SYSTEM_TEAMFOUNDATIONCOLLECTIONURI","pr":"SYSTEM_PULLREQUEST_PULLREQUESTID"},{"name":"Bamboo","constant":"BAMBOO","env":"bamboo_planKey"},{"name":"Bitbucket Pipelines","constant":"BITBUCKET","env":"BITBUCKET_COMMIT","pr":"BITBUCKET_PR_ID"},{"name":"Bitrise","constant":"BITRISE","env":"BITRISE_IO","pr":"BITRISE_PULL_REQUEST"},{"name":"Buddy","constant":"BUDDY","env":"BUDDY_WORKSPACE_ID","pr":"BUDDY_EXECUTION_PULL_REQUEST_ID"},{"name":"Buildkite","constant":"BUILDKITE","env":"BUILDKITE","pr":{"env":"BUILDKITE_PULL_REQUEST","ne":"false"}},{"name":"CircleCI","constant":"CIRCLE","env":"CIRCLECI","pr":"CIRCLE_PULL_REQUEST"},{"name":"Cirrus CI","constant":"CIRRUS","env":"CIRRUS_CI","pr":"CIRRUS_PR"},{"name":"AWS CodeBuild","constant":"CODEBUILD","env":"CODEBUILD_BUILD_ARN"},{"name":"Codeship","constant":"CODESHIP","env":{"CI_NAME":"codeship"}},{"name":"Drone","constant":"DRONE","env":"DRONE","pr":{"DRONE_BUILD_EVENT":"pull_request"}},{"name":"dsari","constant":"DSARI","env":"DSARI"},{"name":"GitLab CI","constant":"GITLAB","env":"GITLAB_CI"},{"name":"GoCD","constant":"GOCD","env":"GO_PIPELINE_LABEL"},{"name":"Hudson","constant":"HUDSON","env":"HUDSON_URL"},{"name":"Jenkins","constant":"JENKINS","env":["JENKINS_URL","BUILD_ID"],"pr":{"any":["ghprbPullId","CHANGE_ID"]}},{"name":"Magnum CI","constant":"MAGNUM","env":"MAGNUM"},{"name":"Netlify CI","constant":"NETLIFY","env":"NETLIFY_BUILD_BASE","pr":{"env":"PULL_REQUEST","ne":"false"}},{"name":"Sail CI","constant":"SAIL","env":"SAILCI","pr":"SAIL_PULL_REQUEST_NUMBER"},{"name":"Semaphore","constant":"SEMAPHORE","env":"SEMAPHORE","pr":"PULL_REQUEST_NUMBER"},{"name":"Shippable","constant":"SHIPPABLE","env":"SHIPPABLE","pr":{"IS_PULL_REQUEST":"true"}},{"name":"Solano CI","constant":"SOLANO","env":"TDDIUM","pr":"TDDIUM_PR_ID"},{"name":"Strider CD","constant":"STRIDER","env":"STRIDER"},{"name":"TaskCluster","constant":"TASKCLUSTER","env":["TASK_ID","RUN_ID"]},{"name":"TeamCity","constant":"TEAMCITY","env":"TEAMCITY_VERSION"},{"name":"Travis CI","constant":"TRAVIS","env":"TRAVIS","pr":{"env":"TRAVIS_PULL_REQUEST","ne":"false"}}]')},801:(t,e,n)=>{const r=n(454),i={};for(const t of Object.keys(r))i[r[t]]=t;const o={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};t.exports=o;for(const t of Object.keys(o)){if(!("channels"in o[t]))throw new Error("missing channels property: "+t);if(!("labels"in o[t]))throw new Error("missing channel labels property: "+t);if(o[t].labels.length!==o[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:e,labels:n}=o[t];delete o[t].channels,delete o[t].labels,Object.defineProperty(o[t],"channels",{value:e}),Object.defineProperty(o[t],"labels",{value:n})}o.rgb.hsl=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=o-i;let a,c;o===i?a=0:e===o?a=(n-r)/s:n===o?a=2+(r-e)/s:r===o&&(a=4+(e-n)/s),a=Math.min(60*a,360),a<0&&(a+=360);const u=(i+o)/2;return c=o===i?0:u<=.5?s/(o+i):s/(2-o-i),[a,100*c,100*u]},o.rgb.hsv=function(t){let e,n,r,i,o;const s=t[0]/255,a=t[1]/255,c=t[2]/255,u=Math.max(s,a,c),l=u-Math.min(s,a,c),h=function(t){return(u-t)/6/l+.5};return 0===l?(i=0,o=0):(o=l/u,e=h(s),n=h(a),r=h(c),s===u?i=r-n:a===u?i=1/3+e-r:c===u&&(i=2/3+n-e),i<0?i+=1:i>1&&(i-=1)),[360*i,100*o,100*u]},o.rgb.hwb=function(t){const e=t[0],n=t[1];let r=t[2];const i=o.rgb.hsl(t)[0],s=1/255*Math.min(e,Math.min(n,r));return r=1-1/255*Math.max(e,Math.max(n,r)),[i,100*s,100*r]},o.rgb.cmyk=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.min(1-e,1-n,1-r);return[100*((1-e-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*((1-r-i)/(1-i)||0),100*i]},o.rgb.keyword=function(t){const e=i[t];if(e)return e;let n,o=1/0;for(const e of Object.keys(r)){const i=r[e],c=(a=i,((s=t)[0]-a[0])**2+(s[1]-a[1])**2+(s[2]-a[2])**2);c<o&&(o=c,n=e)}var s,a;return n},o.keyword.rgb=function(t){return r[t]},o.rgb.xyz=function(t){let e=t[0]/255,n=t[1]/255,r=t[2]/255;e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,r=r>.04045?((r+.055)/1.055)**2.4:r/12.92;return[100*(.4124*e+.3576*n+.1805*r),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},o.rgb.lab=function(t){const e=o.rgb.xyz(t);let n=e[0],r=e[1],i=e[2];n/=95.047,r/=100,i/=108.883,n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*r-16,500*(n-r),200*(r-i)]},o.hsl.rgb=function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100;let i,o,s;if(0===n)return s=255*r,[s,s,s];i=r<.5?r*(1+n):r+n-r*n;const a=2*r-i,c=[0,0,0];for(let t=0;t<3;t++)o=e+1/3*-(t-1),o<0&&o++,o>1&&o--,s=6*o<1?a+6*(i-a)*o:2*o<1?i:3*o<2?a+(i-a)*(2/3-o)*6:a,c[t]=255*s;return c},o.hsl.hsv=function(t){const e=t[0];let n=t[1]/100,r=t[2]/100,i=n;const o=Math.max(r,.01);r*=2,n*=r<=1?r:2-r,i*=o<=1?o:2-o;return[e,100*(0===r?2*i/(o+i):2*n/(r+n)),100*((r+n)/2)]},o.hsv.rgb=function(t){const e=t[0]/60,n=t[1]/100;let r=t[2]/100;const i=Math.floor(e)%6,o=e-Math.floor(e),s=255*r*(1-n),a=255*r*(1-n*o),c=255*r*(1-n*(1-o));switch(r*=255,i){case 0:return[r,c,s];case 1:return[a,r,s];case 2:return[s,r,c];case 3:return[s,a,r];case 4:return[c,s,r];case 5:return[r,s,a]}},o.hsv.hsl=function(t){const e=t[0],n=t[1]/100,r=t[2]/100,i=Math.max(r,.01);let o,s;s=(2-n)*r;const a=(2-n)*i;return o=n*i,o/=a<=1?a:2-a,o=o||0,s/=2,[e,100*o,100*s]},o.hwb.rgb=function(t){const e=t[0]/360;let n=t[1]/100,r=t[2]/100;const i=n+r;let o;i>1&&(n/=i,r/=i);const s=Math.floor(6*e),a=1-r;o=6*e-s,0!=(1&s)&&(o=1-o);const c=n+o*(a-n);let u,l,h;switch(s){default:case 6:case 0:u=a,l=c,h=n;break;case 1:u=c,l=a,h=n;break;case 2:u=n,l=a,h=c;break;case 3:u=n,l=c,h=a;break;case 4:u=c,l=n,h=a;break;case 5:u=a,l=n,h=c}return[255*u,255*l,255*h]},o.cmyk.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},o.xyz.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100;let i,o,s;return i=3.2406*e+-1.5372*n+-.4986*r,o=-.9689*e+1.8758*n+.0415*r,s=.0557*e+-.204*n+1.057*r,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,i=Math.min(Math.max(0,i),1),o=Math.min(Math.max(0,o),1),s=Math.min(Math.max(0,s),1),[255*i,255*o,255*s]},o.xyz.lab=function(t){let e=t[0],n=t[1],r=t[2];e/=95.047,n/=100,r/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116;return[116*n-16,500*(e-n),200*(n-r)]},o.lab.xyz=function(t){let e,n,r;n=(t[0]+16)/116,e=t[1]/500+n,r=n-t[2]/200;const i=n**3,o=e**3,s=r**3;return n=i>.008856?i:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,r=s>.008856?s:(r-16/116)/7.787,e*=95.047,n*=100,r*=108.883,[e,n,r]},o.lab.lch=function(t){const e=t[0],n=t[1],r=t[2];let i;i=360*Math.atan2(r,n)/2/Math.PI,i<0&&(i+=360);return[e,Math.sqrt(n*n+r*r),i]},o.lch.lab=function(t){const e=t[0],n=t[1],r=t[2]/360*2*Math.PI;return[e,n*Math.cos(r),n*Math.sin(r)]},o.rgb.ansi16=function(t,e=null){const[n,r,i]=t;let s=null===e?o.rgb.hsv(t)[2]:e;if(s=Math.round(s/50),0===s)return 30;let a=30+(Math.round(i/255)<<2|Math.round(r/255)<<1|Math.round(n/255));return 2===s&&(a+=60),a},o.hsv.ansi16=function(t){return o.rgb.ansi16(o.hsv.rgb(t),t[2])},o.rgb.ansi256=function(t){const e=t[0],n=t[1],r=t[2];if(e===n&&n===r)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;return 16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},o.ansi16.rgb=function(t){let e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},o.ansi256.rgb=function(t){if(t>=232){const e=10*(t-232)+8;return[e,e,e]}let e;t-=16;return[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},o.rgb.hex=function(t){const e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},o.hex.rgb=function(t){const e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];let n=e[0];3===e[0].length&&(n=n.split("").map(t=>t+t).join(""));const r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},o.rgb.hcg=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.max(Math.max(e,n),r),o=Math.min(Math.min(e,n),r),s=i-o;let a,c;return a=s<1?o/(1-s):0,c=s<=0?0:i===e?(n-r)/s%6:i===n?2+(r-e)/s:4+(e-n)/s,c/=6,c%=1,[360*c,100*s,100*a]},o.hsl.hcg=function(t){const e=t[1]/100,n=t[2]/100,r=n<.5?2*e*n:2*e*(1-n);let i=0;return r<1&&(i=(n-.5*r)/(1-r)),[t[0],100*r,100*i]},o.hsv.hcg=function(t){const e=t[1]/100,n=t[2]/100,r=e*n;let i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},o.hcg.rgb=function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];const i=[0,0,0],o=e%1*6,s=o%1,a=1-s;let c=0;switch(Math.floor(o)){case 0:i[0]=1,i[1]=s,i[2]=0;break;case 1:i[0]=a,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=s;break;case 3:i[0]=0,i[1]=a,i[2]=1;break;case 4:i[0]=s,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=a}return c=(1-n)*r,[255*(n*i[0]+c),255*(n*i[1]+c),255*(n*i[2]+c)]},o.hcg.hsv=function(t){const e=t[1]/100,n=e+t[2]/100*(1-e);let r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},o.hcg.hsl=function(t){const e=t[1]/100,n=t[2]/100*(1-e)+.5*e;let r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},o.hcg.hwb=function(t){const e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},o.hwb.hcg=function(t){const e=t[1]/100,n=1-t[2]/100,r=n-e;let i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},o.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},o.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},o.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},o.gray.hsl=function(t){return[0,0,t[0]]},o.gray.hsv=o.gray.hsl,o.gray.hwb=function(t){return[0,100,t[0]]},o.gray.cmyk=function(t){return[0,0,0,t[0]]},o.gray.lab=function(t){return[t[0],0,0]},o.gray.hex=function(t){const e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},o.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},108:(t,e,n)=>{const r=n(801),i=n(525),o={};Object.keys(r).forEach(t=>{o[t]={},Object.defineProperty(o[t],"channels",{value:r[t].channels}),Object.defineProperty(o[t],"labels",{value:r[t].labels});const e=i(t);Object.keys(e).forEach(n=>{const r=e[n];o[t][n]=function(t){const e=function(...e){const n=e[0];if(null==n)return n;n.length>1&&(e=n);const r=t(e);if("object"==typeof r)for(let t=r.length,e=0;e<t;e++)r[e]=Math.round(r[e]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}(r),o[t][n].raw=function(t){const e=function(...e){const n=e[0];return null==n?n:(n.length>1&&(e=n),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)})}),t.exports=o},525:(t,e,n)=>{const r=n(801);function i(t){const e=function(){const t={},e=Object.keys(r);for(let n=e.length,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;){const t=n.pop(),i=Object.keys(r[t]);for(let r=i.length,o=0;o<r;o++){const r=i[o],s=e[r];-1===s.distance&&(s.distance=e[t].distance+1,s.parent=t,n.unshift(r))}}return e}function o(t,e){return function(n){return e(t(n))}}function s(t,e){const n=[e[t].parent,t];let i=r[e[t].parent][t],s=e[t].parent;for(;e[s].parent;)n.unshift(e[s].parent),i=o(r[e[s].parent][s],i),s=e[s].parent;return i.conversion=n,i}t.exports=function(t){const e=i(t),n={},r=Object.keys(e);for(let t=r.length,i=0;i<t;i++){const t=r[i];null!==e[t].parent&&(n[t]=s(t,e))}return n}},454:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},345:t=>{t.exports=function(t,n){for(var r=[],i=0;i<t.length;i++){var o=n(t[i],i);e(o)?r.push.apply(r,o):r.push(o)}return r};var e=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},248:t=>{"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||t,s),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,i,o,s){var a=n?n+t:t;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,o),!0;case 6:return l.fn.call(l.context,e,r,i,o,s),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,r);break;case 4:l[u].fn.call(l[u].context,e,r,i);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==e||i&&!a[c].once||r&&a[c].context!==r)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&s(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a},562:(t,e,n)=>{t.exports=l,l.realpath=l,l.sync=h,l.realpathSync=h,l.monkeypatch=function(){r.realpath=l,r.realpathSync=h},l.unmonkeypatch=function(){r.realpath=i,r.realpathSync=o};var r=n(747),i=r.realpath,o=r.realpathSync,s=process.version,a=/^v[0-5]\./.test(s),c=n(8);function u(t){return t&&"realpath"===t.syscall&&("ELOOP"===t.code||"ENOMEM"===t.code||"ENAMETOOLONG"===t.code)}function l(t,e,n){if(a)return i(t,e,n);"function"==typeof e&&(n=e,e=null),i(t,e,(function(r,i){u(r)?c.realpath(t,e,n):n(r,i)}))}function h(t,e){if(a)return o(t,e);try{return o(t,e)}catch(n){if(u(n))return c.realpathSync(t,e);throw n}}},8:(t,e,n)=>{var r=n(622),i="win32"===process.platform,o=n(747),s=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function a(t){return"function"==typeof t?t:function(){var t;if(s){var e=new Error;t=function(t){t&&(e.message=t.message,n(t=e))}}else t=n;return t;function n(t){if(t){if(process.throwDeprecation)throw t;if(!process.noDeprecation){var e="fs: missing callback "+(t.stack||t.message);process.traceDeprecation?console.trace(e):console.error(e)}}}}()}r.normalize;if(i)var c=/(.*?)(?:[\/\\]+|$)/g;else c=/(.*?)(?:[\/]+|$)/g;if(i)var u=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/;else u=/^[\/]*/;e.realpathSync=function(t,e){if(t=r.resolve(t),e&&Object.prototype.hasOwnProperty.call(e,t))return e[t];var n,s,a,l,h=t,p={},d={};function f(){var e=u.exec(t);n=e[0].length,s=e[0],a=e[0],l="",i&&!d[a]&&(o.lstatSync(a),d[a]=!0)}for(f();n<t.length;){c.lastIndex=n;var g=c.exec(t);if(l=s,s+=g[0],a=l+g[1],n=c.lastIndex,!(d[a]||e&&e[a]===a)){var m;if(e&&Object.prototype.hasOwnProperty.call(e,a))m=e[a];else{var v=o.lstatSync(a);if(!v.isSymbolicLink()){d[a]=!0,e&&(e[a]=a);continue}var y=null;if(!i){var b=v.dev.toString(32)+":"+v.ino.toString(32);p.hasOwnProperty(b)&&(y=p[b])}null===y&&(o.statSync(a),y=o.readlinkSync(a)),m=r.resolve(l,y),e&&(e[a]=m),i||(p[b]=y)}t=r.resolve(m,t.slice(n)),f()}}return e&&(e[h]=t),t},e.realpath=function(t,e,n){if("function"!=typeof n&&(n=a(e),e=null),t=r.resolve(t),e&&Object.prototype.hasOwnProperty.call(e,t))return process.nextTick(n.bind(null,null,e[t]));var s,l,h,p,d=t,f={},g={};function m(){var e=u.exec(t);s=e[0].length,l=e[0],h=e[0],p="",i&&!g[h]?o.lstat(h,(function(t){if(t)return n(t);g[h]=!0,v()})):process.nextTick(v)}function v(){if(s>=t.length)return e&&(e[d]=t),n(null,t);c.lastIndex=s;var r=c.exec(t);return p=l,l+=r[0],h=p+r[1],s=c.lastIndex,g[h]||e&&e[h]===h?process.nextTick(v):e&&Object.prototype.hasOwnProperty.call(e,h)?w(e[h]):o.lstat(h,y)}function y(t,r){if(t)return n(t);if(!r.isSymbolicLink())return g[h]=!0,e&&(e[h]=h),process.nextTick(v);if(!i){var s=r.dev.toString(32)+":"+r.ino.toString(32);if(f.hasOwnProperty(s))return b(null,f[s],h)}o.stat(h,(function(t){if(t)return n(t);o.readlink(h,(function(t,e){i||(f[s]=e),b(t,e)}))}))}function b(t,i,o){if(t)return n(t);var s=r.resolve(p,i);e&&(e[o]=s),w(s)}function w(e){t=r.resolve(e,t.slice(s)),m()}m()}},712:(t,e,n)=>{function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.setopts=function(t,e,n){n||(n={});if(n.matchBase&&-1===e.indexOf("/")){if(n.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}t.silent=!!n.silent,t.pattern=e,t.strict=!1!==n.strict,t.realpath=!!n.realpath,t.realpathCache=n.realpathCache||Object.create(null),t.follow=!!n.follow,t.dot=!!n.dot,t.mark=!!n.mark,t.nodir=!!n.nodir,t.nodir&&(t.mark=!0);t.sync=!!n.sync,t.nounique=!!n.nounique,t.nonull=!!n.nonull,t.nosort=!!n.nosort,t.nocase=!!n.nocase,t.stat=!!n.stat,t.noprocess=!!n.noprocess,t.absolute=!!n.absolute,t.fs=n.fs||i,t.maxLength=n.maxLength||1/0,t.cache=n.cache||Object.create(null),t.statCache=n.statCache||Object.create(null),t.symlinks=n.symlinks||Object.create(null),function(t,e){t.ignore=e.ignore||[],Array.isArray(t.ignore)||(t.ignore=[t.ignore]);t.ignore.length&&(t.ignore=t.ignore.map(l))}(t,n),t.changedCwd=!1;var s=process.cwd();r(n,"cwd")?(t.cwd=o.resolve(n.cwd),t.changedCwd=t.cwd!==s):t.cwd=s;t.root=n.root||o.resolve(t.cwd,"/"),t.root=o.resolve(t.root),"win32"===process.platform&&(t.root=t.root.replace(/\\/g,"/"));t.cwdAbs=a(t.cwd)?t.cwd:h(t,t.cwd),"win32"===process.platform&&(t.cwdAbs=t.cwdAbs.replace(/\\/g,"/"));t.nomount=!!n.nomount,n.nonegate=!0,n.nocomment=!0,t.minimatch=new c(e,n),t.options=t.minimatch.options},e.ownProp=r,e.makeAbs=h,e.finish=function(t){for(var e=t.nounique,n=e?[]:Object.create(null),r=0,i=t.matches.length;r<i;r++){var o=t.matches[r];if(o&&0!==Object.keys(o).length){var s=Object.keys(o);e?n.push.apply(n,s):s.forEach((function(t){n[t]=!0}))}else if(t.nonull){var a=t.minimatch.globSet[r];e?n.push(a):n[a]=!0}}e||(n=Object.keys(n));t.nosort||(n=n.sort(u));if(t.mark){for(r=0;r<n.length;r++)n[r]=t._mark(n[r]);t.nodir&&(n=n.filter((function(e){var n=!/\/$/.test(e),r=t.cache[e]||t.cache[h(t,e)];return n&&r&&(n="DIR"!==r&&!Array.isArray(r)),n})))}t.ignore.length&&(n=n.filter((function(e){return!p(t,e)})));t.found=n},e.mark=function(t,e){var n=h(t,e),r=t.cache[n],i=e;if(r){var o="DIR"===r||Array.isArray(r),s="/"===e.slice(-1);if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=h(t,i);t.statCache[a]=t.statCache[n],t.cache[a]=t.cache[n]}}return i},e.isIgnored=p,e.childrenIgnored=function(t,e){return!!t.ignore.length&&t.ignore.some((function(t){return!(!t.gmatcher||!t.gmatcher.match(e))}))};var i=n(747),o=n(622),s=n(494),a=n(993),c=s.Minimatch;function u(t,e){return t.localeCompare(e,"en")}function l(t){var e=null;if("/**"===t.slice(-3)){var n=t.replace(/(\/\*\*)+$/,"");e=new c(n,{dot:!0})}return{matcher:new c(t,{dot:!0}),gmatcher:e}}function h(t,e){var n=e;return n="/"===e.charAt(0)?o.join(t.root,e):a(e)||""===e?e:t.changedCwd?o.resolve(t.cwd,e):o.resolve(e),"win32"===process.platform&&(n=n.replace(/\\/g,"/")),n}function p(t,e){return!!t.ignore.length&&t.ignore.some((function(t){return t.matcher.match(e)||!(!t.gmatcher||!t.gmatcher.match(e))}))}},142:(t,e,n)=>{t.exports=y;var r=n(562),i=n(494),o=(i.Minimatch,n(564)),s=n(614).EventEmitter,a=n(622),c=n(357),u=n(993),l=n(372),h=n(712),p=h.setopts,d=h.ownProp,f=n(866),g=(n(669),h.childrenIgnored),m=h.isIgnored,v=n(383);function y(t,e,n){if("function"==typeof e&&(n=e,e={}),e||(e={}),e.sync){if(n)throw new TypeError("callback provided to sync glob");return l(t,e)}return new w(t,e,n)}y.sync=l;var b=y.GlobSync=l.GlobSync;function w(t,e,n){if("function"==typeof e&&(n=e,e=null),e&&e.sync){if(n)throw new TypeError("callback provided to sync glob");return new b(t,e)}if(!(this instanceof w))return new w(t,e,n);p(this,t,e),this._didRealPath=!1;var r=this.minimatch.set.length;this.matches=new Array(r),"function"==typeof n&&(n=v(n),this.on("error",n),this.on("end",(function(t){n(null,t)})));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===r)return s();for(var o=0;o<r;o++)this._process(this.minimatch.set[o],o,!1,s);function s(){--i._processing,i._processing<=0&&i._finish()}}y.glob=y,y.hasMagic=function(t,e){var n=function(t,e){if(null===e||"object"!=typeof e)return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}({},e);n.noprocess=!0;var r=new w(t,n).minimatch.set;if(!t)return!1;if(r.length>1)return!0;for(var i=0;i<r[0].length;i++)if("string"!=typeof r[0][i])return!0;return!1},y.Glob=w,o(w,s),w.prototype._finish=function(){if(c(this instanceof w),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();h.finish(this),this.emit("end",this.found)}},w.prototype._realpath=function(){if(!this._didRealpath){this._didRealpath=!0;var t=this.matches.length;if(0===t)return this._finish();for(var e=this,n=0;n<this.matches.length;n++)this._realpathSet(n,r)}function r(){0==--t&&e._finish()}},w.prototype._realpathSet=function(t,e){var n=this.matches[t];if(!n)return e();var i=Object.keys(n),o=this,s=i.length;if(0===s)return e();var a=this.matches[t]=Object.create(null);i.forEach((function(n,i){n=o._makeAbs(n),r.realpath(n,o.realpathCache,(function(r,i){r?"stat"===r.syscall?a[n]=!0:o.emit("error",r):a[i]=!0,0==--s&&(o.matches[t]=a,e())}))}))},w.prototype._mark=function(t){return h.mark(this,t)},w.prototype._makeAbs=function(t){return h.makeAbs(this,t)},w.prototype.abort=function(){this.aborted=!0,this.emit("abort")},w.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},w.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var t=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<t.length;e++){var n=t[e];this._emitMatch(n[0],n[1])}}if(this._processQueue.length){var r=this._processQueue.slice(0);this._processQueue.length=0;for(e=0;e<r.length;e++){var i=r[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}},w.prototype._process=function(t,e,n,r){if(c(this instanceof w),c("function"==typeof r),!this.aborted)if(this._processing++,this.paused)this._processQueue.push([t,e,n,r]);else{for(var o,s=0;"string"==typeof t[s];)s++;switch(s){case t.length:return void this._processSimple(t.join("/"),e,r);case 0:o=null;break;default:o=t.slice(0,s).join("/")}var a,l=t.slice(s);null===o?a=".":u(o)||u(t.join("/"))?(o&&u(o)||(o="/"+o),a=o):a=o;var h=this._makeAbs(a);if(g(this,a))return r();l[0]===i.GLOBSTAR?this._processGlobStar(o,a,h,l,e,n,r):this._processReaddir(o,a,h,l,e,n,r)}},w.prototype._processReaddir=function(t,e,n,r,i,o,s){var a=this;this._readdir(n,o,(function(c,u){return a._processReaddir2(t,e,n,r,i,o,u,s)}))},w.prototype._processReaddir2=function(t,e,n,r,i,o,s,c){if(!s)return c();for(var u=r[0],l=!!this.minimatch.negate,h=u._glob,p=this.dot||"."===h.charAt(0),d=[],f=0;f<s.length;f++){if("."!==(m=s[f]).charAt(0)||p)(l&&!t?!m.match(u):m.match(u))&&d.push(m)}var g=d.length;if(0===g)return c();if(1===r.length&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(f=0;f<g;f++){var m=d[f];t&&(m="/"!==t?t+"/"+m:t+m),"/"!==m.charAt(0)||this.nomount||(m=a.join(this.root,m)),this._emitMatch(i,m)}return c()}r.shift();for(f=0;f<g;f++){m=d[f];t&&(m="/"!==t?t+"/"+m:t+m),this._process([m].concat(r),i,o,c)}c()},w.prototype._emitMatch=function(t,e){if(!this.aborted&&!m(this,e))if(this.paused)this._emitQueue.push([t,e]);else{var n=u(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=n),!this.matches[t][e]){if(this.nodir){var r=this.cache[n];if("DIR"===r||Array.isArray(r))return}this.matches[t][e]=!0;var i=this.statCache[n];i&&this.emit("stat",e,i),this.emit("match",e)}}},w.prototype._readdirInGlobStar=function(t,e){if(!this.aborted){if(this.follow)return this._readdir(t,!1,e);var n=this,r=f("lstat\0"+t,(function(r,i){if(r&&"ENOENT"===r.code)return e();var o=i&&i.isSymbolicLink();n.symlinks[t]=o,o||!i||i.isDirectory()?n._readdir(t,!1,e):(n.cache[t]="FILE",e())}));r&&n.fs.lstat(t,r)}},w.prototype._readdir=function(t,e,n){if(!this.aborted&&(n=f("readdir\0"+t+"\0"+e,n))){if(e&&!d(this.symlinks,t))return this._readdirInGlobStar(t,n);if(d(this.cache,t)){var r=this.cache[t];if(!r||"FILE"===r)return n();if(Array.isArray(r))return n(null,r)}this.fs.readdir(t,function(t,e,n){return function(r,i){r?t._readdirError(e,r,n):t._readdirEntries(e,i,n)}}(this,t,n))}},w.prototype._readdirEntries=function(t,e,n){if(!this.aborted){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];i="/"===t?t+i:t+"/"+i,this.cache[i]=!0}return this.cache[t]=e,n(null,e)}},w.prototype._readdirError=function(t,e,n){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(t);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:this.cache[this._makeAbs(t)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e)}return n()}},w.prototype._processGlobStar=function(t,e,n,r,i,o,s){var a=this;this._readdir(n,o,(function(c,u){a._processGlobStar2(t,e,n,r,i,o,u,s)}))},w.prototype._processGlobStar2=function(t,e,n,r,i,o,s,a){if(!s)return a();var c=r.slice(1),u=t?[t]:[],l=u.concat(c);this._process(l,i,!1,a);var h=this.symlinks[n],p=s.length;if(h&&o)return a();for(var d=0;d<p;d++){if("."!==s[d].charAt(0)||this.dot){var f=u.concat(s[d],c);this._process(f,i,!0,a);var g=u.concat(s[d],r);this._process(g,i,!0,a)}}a()},w.prototype._processSimple=function(t,e,n){var r=this;this._stat(t,(function(i,o){r._processSimple2(t,e,i,o,n)}))},w.prototype._processSimple2=function(t,e,n,r,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!r)return i();if(t&&u(t)&&!this.nomount){var o=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=a.join(this.root,t):(t=a.resolve(this.root,t),o&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t),i()},w.prototype._stat=function(t,e){var n=this._makeAbs(t),r="/"===t.slice(-1);if(t.length>this.maxLength)return e();if(!this.stat&&d(this.cache,n)){var i=this.cache[n];if(Array.isArray(i)&&(i="DIR"),!r||"DIR"===i)return e(null,i);if(r&&"FILE"===i)return e()}var o=this.statCache[n];if(void 0!==o){if(!1===o)return e(null,o);var s=o.isDirectory()?"DIR":"FILE";return r&&"FILE"===s?e():e(null,s,o)}var a=this,c=f("stat\0"+n,(function(r,i){if(i&&i.isSymbolicLink())return a.fs.stat(n,(function(r,o){r?a._stat2(t,n,null,i,e):a._stat2(t,n,r,o,e)}));a._stat2(t,n,r,i,e)}));c&&a.fs.lstat(n,c)},w.prototype._stat2=function(t,e,n,r,i){if(n&&("ENOENT"===n.code||"ENOTDIR"===n.code))return this.statCache[e]=!1,i();var o="/"===t.slice(-1);if(this.statCache[e]=r,"/"===e.slice(-1)&&r&&!r.isDirectory())return i(null,!1,r);var s=!0;return r&&(s=r.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&"FILE"===s?i():i(null,s,r)}},372:(t,e,n)=>{t.exports=d,d.GlobSync=f;var r=n(562),i=n(494),o=(i.Minimatch,n(142).Glob,n(669),n(622)),s=n(357),a=n(993),c=n(712),u=c.setopts,l=c.ownProp,h=c.childrenIgnored,p=c.isIgnored;function d(t,e){if("function"==typeof e||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new f(t,e).found}function f(t,e){if(!t)throw new Error("must provide pattern");if("function"==typeof e||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof f))return new f(t,e);if(u(this,t,e),this.noprocess)return this;var n=this.minimatch.set.length;this.matches=new Array(n);for(var r=0;r<n;r++)this._process(this.minimatch.set[r],r,!1);this._finish()}f.prototype._finish=function(){if(s(this instanceof f),this.realpath){var t=this;this.matches.forEach((function(e,n){var i=t.matches[n]=Object.create(null);for(var o in e)try{o=t._makeAbs(o),i[r.realpathSync(o,t.realpathCache)]=!0}catch(e){if("stat"!==e.syscall)throw e;i[t._makeAbs(o)]=!0}}))}c.finish(this)},f.prototype._process=function(t,e,n){s(this instanceof f);for(var r,o=0;"string"==typeof t[o];)o++;switch(o){case t.length:return void this._processSimple(t.join("/"),e);case 0:r=null;break;default:r=t.slice(0,o).join("/")}var c,u=t.slice(o);null===r?c=".":a(r)||a(t.join("/"))?(r&&a(r)||(r="/"+r),c=r):c=r;var l=this._makeAbs(c);h(this,c)||(u[0]===i.GLOBSTAR?this._processGlobStar(r,c,l,u,e,n):this._processReaddir(r,c,l,u,e,n))},f.prototype._processReaddir=function(t,e,n,r,i,s){var a=this._readdir(n,s);if(a){for(var c=r[0],u=!!this.minimatch.negate,l=c._glob,h=this.dot||"."===l.charAt(0),p=[],d=0;d<a.length;d++){if("."!==(m=a[d]).charAt(0)||h)(u&&!t?!m.match(c):m.match(c))&&p.push(m)}var f=p.length;if(0!==f)if(1!==r.length||this.mark||this.stat){r.shift();for(d=0;d<f;d++){var g;m=p[d];g=t?[t,m]:[m],this._process(g.concat(r),i,s)}}else{this.matches[i]||(this.matches[i]=Object.create(null));for(var d=0;d<f;d++){var m=p[d];t&&(m="/"!==t.slice(-1)?t+"/"+m:t+m),"/"!==m.charAt(0)||this.nomount||(m=o.join(this.root,m)),this._emitMatch(i,m)}}}},f.prototype._emitMatch=function(t,e){if(!p(this,e)){var n=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=n),!this.matches[t][e]){if(this.nodir){var r=this.cache[n];if("DIR"===r||Array.isArray(r))return}this.matches[t][e]=!0,this.stat&&this._stat(e)}}},f.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var e,n;try{n=this.fs.lstatSync(t)}catch(t){if("ENOENT"===t.code)return null}var r=n&&n.isSymbolicLink();return this.symlinks[t]=r,r||!n||n.isDirectory()?e=this._readdir(t,!1):this.cache[t]="FILE",e},f.prototype._readdir=function(t,e){if(e&&!l(this.symlinks,t))return this._readdirInGlobStar(t);if(l(this.cache,t)){var n=this.cache[t];if(!n||"FILE"===n)return null;if(Array.isArray(n))return n}try{return this._readdirEntries(t,this.fs.readdirSync(t))}catch(e){return this._readdirError(t,e),null}},f.prototype._readdirEntries=function(t,e){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var r=e[n];r="/"===t?t+r:t+"/"+r,this.cache[r]=!0}return this.cache[t]=e,e},f.prototype._readdirError=function(t,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(t);if(this.cache[n]="FILE",n===this.cwdAbs){var r=new Error(e.code+" invalid cwd "+this.cwd);throw r.path=this.cwd,r.code=e.code,r}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw e;this.silent||console.error("glob error",e)}},f.prototype._processGlobStar=function(t,e,n,r,i,o){var s=this._readdir(n,o);if(s){var a=r.slice(1),c=t?[t]:[],u=c.concat(a);this._process(u,i,!1);var l=s.length;if(!this.symlinks[n]||!o)for(var h=0;h<l;h++){if("."!==s[h].charAt(0)||this.dot){var p=c.concat(s[h],a);this._process(p,i,!0);var d=c.concat(s[h],r);this._process(d,i,!0)}}}},f.prototype._processSimple=function(t,e){var n=this._stat(t);if(this.matches[e]||(this.matches[e]=Object.create(null)),n){if(t&&a(t)&&!this.nomount){var r=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=o.join(this.root,t):(t=o.resolve(this.root,t),r&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t)}},f.prototype._stat=function(t){var e=this._makeAbs(t),n="/"===t.slice(-1);if(t.length>this.maxLength)return!1;if(!this.stat&&l(this.cache,e)){var r=this.cache[e];if(Array.isArray(r)&&(r="DIR"),!n||"DIR"===r)return r;if(n&&"FILE"===r)return!1}var i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(t){if(t&&("ENOENT"===t.code||"ENOTDIR"===t.code))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch(t){i=o}else i=o}this.statCache[e]=i;r=!0;return i&&(r=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||r,(!n||"FILE"!==r)&&r},f.prototype._mark=function(t){return c.mark(this,t)},f.prototype._makeAbs=function(t){return c.makeAbs(this,t)}},770:t=>{function e(t){return Array.isArray(t)?t:[t]}const n=/^\s+$/,r=/^\\!/,i=/^\\#/,o=/\r?\n/g,s=/^\.*\/|^\.+$/,a="undefined"!=typeof Symbol?Symbol.for("node-ignore"):"node-ignore",c=/([0-z])-([0-z])/g,u=[[/\\?\s+$/,t=>0===t.indexOf("\\")?" ":""],[/\\\s/g,()=>" "],[/[\\$.|*+(){^]/g,t=>"\\"+t],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(t,e,n)=>e+6<n.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)\\\*(?=.+)/g,(t,e)=>e+"[^\\/]*"],[/\\\\\\(?=[$.|*+(){^])/g,()=>"\\"],[/\\\\/g,()=>"\\"],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(t,e,n,r,i)=>"\\"===e?`\\[${n}${(t=>{const{length:e}=t;return t.slice(0,e-e%2)})(r)}${i}`:"]"===i&&r.length%2==0?`[${(t=>t.replace(c,(t,e,n)=>e.charCodeAt(0)<=n.charCodeAt(0)?t:""))(n)}${r}]`:"[]"],[/(?:[^*])$/,t=>/\/$/.test(t)?t+"$":t+"(?=$|\\/$)"],[/(\^|\\\/)?\\\*$/,(t,e)=>(e?e+"[^/]+":"[^/]*")+"(?=$|\\/$)"]],l=Object.create(null),h=t=>"string"==typeof t;class p{constructor(t,e,n,r){this.origin=t,this.pattern=e,this.negative=n,this.regex=r}}const d=(t,e)=>{const n=t;let o=!1;0===t.indexOf("!")&&(o=!0,t=t.substr(1));const s=((t,e,n)=>{const r=l[t];if(r)return r;const i=u.reduce((e,n)=>e.replace(n[0],n[1].bind(t)),t);return l[t]=n?new RegExp(i,"i"):new RegExp(i)})(t=t.replace(r,"!").replace(i,"#"),0,e);return new p(n,t,o,s)},f=(t,e)=>{throw new e(t)},g=(t,e,n)=>{if(!h(t))return n(`path must be a string, but got \`${e}\``,TypeError);if(!t)return n("path must not be empty",TypeError);if(g.isNotRelative(t)){return n(`path should be a ${"`path.relative()`d"} string, but got "${e}"`,RangeError)}return!0},m=t=>s.test(t);g.isNotRelative=m,g.convert=t=>t;class v{constructor({ignorecase:t=!0}={}){var e,n,r;this._rules=[],this._ignorecase=t,e=this,n=a,r=!0,Object.defineProperty(e,n,{value:r}),this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(t){if(t&&t[a])return this._rules=this._rules.concat(t._rules),void(this._added=!0);if((t=>t&&h(t)&&!n.test(t)&&0!==t.indexOf("#"))(t)){const e=d(t,this._ignorecase);this._added=!0,this._rules.push(e)}}add(t){return this._added=!1,e(h(t)?(t=>t.split(o))(t):t).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(t){return this.add(t)}_testOne(t,e){let n=!1,r=!1;return this._rules.forEach(i=>{const{negative:o}=i;if(r===o&&n!==r||o&&!n&&!r&&!e)return;i.regex.test(t)&&(n=!o,r=o)}),{ignored:n,unignored:r}}_test(t,e,n,r){const i=t&&g.convert(t);return g(i,t,f),this._t(i,e,n,r)}_t(t,e,n,r){if(t in e)return e[t];if(r||(r=t.split("/")),r.pop(),!r.length)return e[t]=this._testOne(t,n);const i=this._t(r.join("/")+"/",e,n,r);return e[t]=i.ignored?i:this._testOne(t,n)}ignores(t){return this._test(t,this._ignoreCache,!1).ignored}createFilter(){return t=>!this.ignores(t)}filter(t){return e(t).filter(this.createFilter())}test(t){return this._test(t,this._testCache,!0)}}const y=t=>new v(t),b=()=>!1;if(y.isPathValid=t=>g(t&&g.convert(t),t,b),y.default=y,t.exports=y,"undefined"!=typeof process&&(process.env&&process.env.IGNORE_TEST_WIN32||"win32"===process.platform)){const t=t=>/^\\\\\?\\/.test(t)||/["<>|\u0000-\u001F]+/u.test(t)?t:t.replace(/\\/g,"/");g.convert=t;const e=/^[a-z]:\//i;g.isNotRelative=t=>e.test(t)||m(t)}},866:(t,e,n)=>{var r=n(755),i=Object.create(null),o=n(383);function s(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r]=t[r];return n}t.exports=r((function(t,e){return i[t]?(i[t].push(e),null):(i[t]=[e],function(t){return o((function e(){var n=i[t],r=n.length,o=s(arguments);try{for(var a=0;a<r;a++)n[a].apply(null,o)}finally{n.length>r?(n.splice(0,r),process.nextTick((function(){e.apply(null,o)}))):delete i[t]}}))}(t))}))},564:(t,e,n)=>{try{var r=n(669);if("function"!=typeof r.inherits)throw"";t.exports=r.inherits}catch(e){t.exports=n(218)}},218:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},76:(t,e,n)=>{"use strict";t.exports=n(168).isCI},917:t=>{"use strict";const e=t=>!Number.isNaN(t)&&(t>=4352&&(t<=4447||9001===t||9002===t||11904<=t&&t<=12871&&12351!==t||12880<=t&&t<=19903||19968<=t&&t<=42182||43360<=t&&t<=43388||44032<=t&&t<=55203||63744<=t&&t<=64255||65040<=t&&t<=65049||65072<=t&&t<=65131||65281<=t&&t<=65376||65504<=t&&t<=65510||110592<=t&&t<=110593||127488<=t&&t<=127569||131072<=t&&t<=262141));t.exports=e,t.exports.default=e},494:(t,e,n)=>{t.exports=l,l.Minimatch=h;var r={sep:"/"};try{r=n(622)}catch(t){}var i=l.GLOBSTAR=h.GLOBSTAR={},o=n(790),s={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},a="().*{}+?[]^$\\!".split("").reduce((function(t,e){return t[e]=!0,t}),{});var c=/\/+/;function u(t,e){t=t||{},e=e||{};var n={};return Object.keys(e).forEach((function(t){n[t]=e[t]})),Object.keys(t).forEach((function(e){n[e]=t[e]})),n}function l(t,e,n){if("string"!=typeof e)throw new TypeError("glob pattern string required");return n||(n={}),!(!n.nocomment&&"#"===e.charAt(0))&&(""===e.trim()?""===t:new h(e,n).match(t))}function h(t,e){if(!(this instanceof h))return new h(t,e);if("string"!=typeof t)throw new TypeError("glob pattern string required");e||(e={}),t=t.trim(),"/"!==r.sep&&(t=t.split(r.sep).join("/")),this.options=e,this.set=[],this.pattern=t,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}function p(t,e){if(e||(e=this instanceof h?this.options:{}),void 0===(t=void 0===t?this.pattern:t))throw new TypeError("undefined pattern");return e.nobrace||!t.match(/\{.*\}/)?[t]:o(t)}l.filter=function(t,e){return e=e||{},function(n,r,i){return l(n,t,e)}},l.defaults=function(t){if(!t||!Object.keys(t).length)return l;var e=l,n=function(n,r,i){return e.minimatch(n,r,u(t,i))};return n.Minimatch=function(n,r){return new e.Minimatch(n,u(t,r))},n},h.defaults=function(t){return t&&Object.keys(t).length?l.defaults(t).Minimatch:h},h.prototype.debug=function(){},h.prototype.make=function(){if(this._made)return;var t=this.pattern,e=this.options;if(!e.nocomment&&"#"===t.charAt(0))return void(this.comment=!0);if(!t)return void(this.empty=!0);this.parseNegate();var n=this.globSet=this.braceExpand();e.debug&&(this.debug=console.error);this.debug(this.pattern,n),n=this.globParts=n.map((function(t){return t.split(c)})),this.debug(this.pattern,n),n=n.map((function(t,e,n){return t.map(this.parse,this)}),this),this.debug(this.pattern,n),n=n.filter((function(t){return-1===t.indexOf(!1)})),this.debug(this.pattern,n),this.set=n},h.prototype.parseNegate=function(){var t=this.pattern,e=!1,n=this.options,r=0;if(n.nonegate)return;for(var i=0,o=t.length;i<o&&"!"===t.charAt(i);i++)e=!e,r++;r&&(this.pattern=t.substr(r));this.negate=e},l.braceExpand=function(t,e){return p(t,e)},h.prototype.braceExpand=p,h.prototype.parse=function(t,e){if(t.length>65536)throw new TypeError("pattern is too long");var n=this.options;if(!n.noglobstar&&"**"===t)return i;if(""===t)return"";var r,o="",c=!!n.nocase,u=!1,l=[],h=[],p=!1,f=-1,g=-1,m="."===t.charAt(0)?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",v=this;function y(){if(r){switch(r){case"*":o+="[^/]*?",c=!0;break;case"?":o+="[^/]",c=!0;break;default:o+="\\"+r}v.debug("clearStateChar %j %j",r,o),r=!1}}for(var b,w=0,k=t.length;w<k&&(b=t.charAt(w));w++)if(this.debug("%s\t%s %s %j",t,w,o,b),u&&a[b])o+="\\"+b,u=!1;else switch(b){case"/":return!1;case"\\":y(),u=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",t,w,o,b),p){this.debug("  in class"),"!"===b&&w===g+1&&(b="^"),o+=b;continue}v.debug("call clearStateChar %j",r),y(),r=b,n.noext&&y();continue;case"(":if(p){o+="(";continue}if(!r){o+="\\(";continue}l.push({type:r,start:w-1,reStart:o.length,open:s[r].open,close:s[r].close}),o+="!"===r?"(?:(?!(?:":"(?:",this.debug("plType %j %j",r,o),r=!1;continue;case")":if(p||!l.length){o+="\\)";continue}y(),c=!0;var C=l.pop();o+=C.close,"!"===C.type&&h.push(C),C.reEnd=o.length;continue;case"|":if(p||!l.length||u){o+="\\|",u=!1;continue}y(),o+="|";continue;case"[":if(y(),p){o+="\\"+b;continue}p=!0,g=w,f=o.length,o+=b;continue;case"]":if(w===g+1||!p){o+="\\"+b,u=!1;continue}if(p){var _=t.substring(g+1,w);try{RegExp("["+_+"]")}catch(t){var x=this.parse(_,d);o=o.substr(0,f)+"\\["+x[0]+"\\]",c=c||x[1],p=!1;continue}}c=!0,p=!1,o+=b;continue;default:y(),u?u=!1:!a[b]||"^"===b&&p||(o+="\\"),o+=b}p&&(_=t.substr(g+1),x=this.parse(_,d),o=o.substr(0,f)+"\\["+x[0],c=c||x[1]);for(C=l.pop();C;C=l.pop()){var E=o.slice(C.reStart+C.open.length);this.debug("setting tail",o,C),E=E.replace(/((?:\\{2}){0,64})(\\?)\|/g,(function(t,e,n){return n||(n="\\"),e+e+n+"|"})),this.debug("tail=%j\n   %s",E,E,C,o);var I="*"===C.type?"[^/]*?":"?"===C.type?"[^/]":"\\"+C.type;c=!0,o=o.slice(0,C.reStart)+I+"\\("+E}y(),u&&(o+="\\\\");var R=!1;switch(o.charAt(0)){case".":case"[":case"(":R=!0}for(var S=h.length-1;S>-1;S--){var A=h[S],O=o.slice(0,A.reStart),j=o.slice(A.reStart,A.reEnd-8),T=o.slice(A.reEnd-8,A.reEnd),$=o.slice(A.reEnd);T+=$;var M=O.split("(").length-1,L=$;for(w=0;w<M;w++)L=L.replace(/\)[+*?]?/,"");var N="";""===($=L)&&e!==d&&(N="$"),o=O+j+$+N+T}""!==o&&c&&(o="(?=.)"+o);R&&(o=m+o);if(e===d)return[o,c];if(!c)return function(t){return t.replace(/\\(.)/g,"$1")}(t);var P=n.nocase?"i":"";try{var D=new RegExp("^"+o+"$",P)}catch(t){return new RegExp("$.")}return D._glob=t,D._src=o,D};var d={};l.makeRe=function(t,e){return new h(t,e||{}).makeRe()},h.prototype.makeRe=function(){if(this.regexp||!1===this.regexp)return this.regexp;var t=this.set;if(!t.length)return this.regexp=!1,this.regexp;var e=this.options,n=e.noglobstar?"[^/]*?":e.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=e.nocase?"i":"",o=t.map((function(t){return t.map((function(t){return t===i?n:"string"==typeof t?function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}(t):t._src})).join("\\/")})).join("|");o="^(?:"+o+")$",this.negate&&(o="^(?!"+o+").*$");try{this.regexp=new RegExp(o,r)}catch(t){this.regexp=!1}return this.regexp},l.match=function(t,e,n){var r=new h(e,n=n||{});return t=t.filter((function(t){return r.match(t)})),r.options.nonull&&!t.length&&t.push(e),t},h.prototype.match=function(t,e){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;var n=this.options;"/"!==r.sep&&(t=t.split(r.sep).join("/"));t=t.split(c),this.debug(this.pattern,"split",t);var i,o,s=this.set;for(this.debug(this.pattern,"set",s),o=t.length-1;o>=0&&!(i=t[o]);o--);for(o=0;o<s.length;o++){var a=s[o],u=t;if(n.matchBase&&1===a.length&&(u=[i]),this.matchOne(u,a,e))return!!n.flipNegate||!this.negate}return!n.flipNegate&&this.negate},h.prototype.matchOne=function(t,e,n){var r=this.options;this.debug("matchOne",{this:this,file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,s=0,a=t.length,c=e.length;o<a&&s<c;o++,s++){this.debug("matchOne loop");var u,l=e[s],h=t[o];if(this.debug(e,l,h),!1===l)return!1;if(l===i){this.debug("GLOBSTAR",[e,l,h]);var p=o,d=s+1;if(d===c){for(this.debug("** at the end");o<a;o++)if("."===t[o]||".."===t[o]||!r.dot&&"."===t[o].charAt(0))return!1;return!0}for(;p<a;){var f=t[p];if(this.debug("\nglobstar while",t,p,e,d,f),this.matchOne(t.slice(p),e.slice(d),n))return this.debug("globstar found match!",p,a,f),!0;if("."===f||".."===f||!r.dot&&"."===f.charAt(0)){this.debug("dot detected!",t,p,e,d);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!n||(this.debug("\n>>> no match, partial?",t,p,e,d),p!==a))}if("string"==typeof l?(u=r.nocase?h.toLowerCase()===l.toLowerCase():h===l,this.debug("string match",l,h,u)):(u=h.match(l),this.debug("pattern match",l,h,u)),!u)return!1}if(o===a&&s===c)return!0;if(o===a)return n;if(s===c)return o===a-1&&""===t[o];throw new Error("wtf?")}},383:(t,e,n)=>{var r=n(755);function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function o(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},n=t.name||"Function wrapped with `once`";return e.onceError=n+" shouldn't be called more than once",e.called=!1,e}t.exports=r(i),t.exports.strict=r(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},82:t=>{"use strict";t.exports=(t,e)=>(e=e||(()=>{}),t.then(t=>new Promise(t=>{t(e())}).then(()=>t),t=>new Promise(t=>{t(e())}).then(()=>{throw t})))},251:(t,e,n)=>{"use strict";const r=n(504),i=t=>{if(!Number.isInteger(t)&&t!==1/0||!(t>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const e=[];let n=0;const i=()=>{n--,e.length>0&&e.shift()()},o=(t,e,...o)=>{n++;const s=r(t,...o);e(s),s.then(i,i)},s=(r,...i)=>new Promise(s=>((r,i,...s)=>{n<t?o(r,i,...s):e.push(o.bind(null,r,i,...s))})(r,s,...i));return Object.defineProperties(s,{activeCount:{get:()=>n},pendingCount:{get:()=>e.length},clearQueue:{value:()=>{e.length=0}}}),s};t.exports=i,t.exports.default=i},804:(t,e,n)=>{"use strict";const r=n(248),i=n(839),o=n(381),s=()=>{},a=new i.TimeoutError;e.Z=class extends r{constructor(t){var e,n,r,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(t=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:o.default},t)).intervalCap&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(e=t.intervalCap)||void 0===e?void 0:e.toString())&&void 0!==n?n:""}\` (${typeof t.intervalCap})`);if(void 0===t.interval||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(r=t.interval)||void 0===r?void 0:r.toString())&&void 0!==i?i:""}\` (${typeof t.interval})`);this._carryoverConcurrencyCount=t.carryoverConcurrencyCount,this._isIntervalIgnored=t.intervalCap===1/0||0===t.interval,this._intervalCap=t.intervalCap,this._interval=t.interval,this._queue=new t.queueClass,this._queueClass=t.queueClass,this.concurrency=t.concurrency,this._timeout=t.timeout,this._throwOnTimeout=!0===t.throwOnTimeout,this._isPaused=!1===t.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const t=Date.now();if(void 0===this._intervalId){const e=this._intervalEnd-t;if(!(e<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},e)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const t=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const e=this._queue.dequeue();return!!e&&(this.emit("active"),e(),t&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(t){if(!("number"==typeof t&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);this._concurrency=t,this._processQueue()}async add(t,e={}){return new Promise((n,r)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const o=void 0===this._timeout&&void 0===e.timeout?t():i.default(Promise.resolve(t()),void 0===e.timeout?this._timeout:e.timeout,()=>{(void 0===e.throwOnTimeout?this._throwOnTimeout:e.throwOnTimeout)&&r(a)});n(await o)}catch(t){r(t)}this._next()},e),this._tryToStartAnother(),this.emit("add")})}async addAll(t,e){return Promise.all(t.map(async t=>this.add(t,e)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(t=>{const e=this._resolveEmpty;this._resolveEmpty=()=>{e(),t()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(t=>{const e=this._resolveIdle;this._resolveIdle=()=>{e(),t()}})}get size(){return this._queue.size}sizeBy(t){return this._queue.filter(t).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(t){this._timeout=t}}},450:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){let r=0,i=t.length;for(;i>0;){const o=i/2|0;let s=r+o;n(t[s],e)<=0?(r=++s,i-=o+1):i=o}return r}},381:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(450);e.default=class{constructor(){this._queue=[]}enqueue(t,e){const n={priority:(e=Object.assign({priority:0},e)).priority,run:t};if(this.size&&this._queue[this.size-1].priority>=e.priority)return void this._queue.push(n);const i=r.default(this._queue,n,(t,e)=>e.priority-t.priority);this._queue.splice(i,0,n)}dequeue(){const t=this._queue.shift();return null==t?void 0:t.run}filter(t){return this._queue.filter(e=>e.priority===t.priority).map(t=>t.run)}get size(){return this._queue.length}}},839:(t,e,n)=>{"use strict";const r=n(82);class i extends Error{constructor(t){super(t),this.name="TimeoutError"}}const o=(t,e,n)=>new Promise((o,s)=>{if("number"!=typeof e||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0)return void o(t);const a=setTimeout(()=>{if("function"==typeof n){try{o(n())}catch(t){s(t)}return}const r=n instanceof Error?n:new i("string"==typeof n?n:`Promise timed out after ${e} milliseconds`);"function"==typeof t.cancel&&t.cancel(),s(r)},e);r(t.then(o,s),()=>{clearTimeout(a)})});t.exports=o,t.exports.default=o,t.exports.TimeoutError=i},504:t=>{"use strict";const e=(t,...e)=>new Promise(n=>{n(t(...e))});t.exports=e,t.exports.default=e},993:t=>{"use strict";function e(t){return"/"===t.charAt(0)}function n(t){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),n=e[1]||"",r=Boolean(n&&":"!==n.charAt(1));return Boolean(e[2]||r)}t.exports="win32"===process.platform?n:e,t.exports.posix=e,t.exports.win32=n},52:(t,e,n)=>{"use strict";const r=n(917),i=n(598),o=n(891),s=["",""],a=t=>`${s[0]}[${t}m`,c=(t,e,n)=>{let r=[];t=[...t];for(let n of t){const i=n;n.includes(";")&&(n=n.split(";")[0][0]+"0");const s=o.codes.get(Number.parseInt(n,10));if(s){const n=t.indexOf(s.toString());-1===n?r.push(a(e?s:i)):t.splice(n,1)}else{if(e){r.push(a(0));break}r.push(a(i))}}if(e&&(r=r.filter((t,e)=>r.indexOf(t)===e),void 0!==n)){const t=a(o.codes.get(Number.parseInt(n,10)));r=r.reduce((e,n)=>n===t?[n,...e]:[...e,n],[])}return r.join("")};t.exports=(t,e,n)=>{const o=[...t],a=[];let u,l="number"==typeof n?n:o.length,h=!1,p=0,d="";for(const[f,g]of o.entries()){let o=!1;if(s.includes(g)){const e=/\d[^m]*/.exec(t.slice(f,f+18));u=e&&e.length>0?e[0]:void 0,p<l&&(h=!0,void 0!==u&&a.push(u))}else h&&"m"===g&&(h=!1,o=!0);if(h||o||p++,!i({exact:!0}).test(g)&&r(g.codePointAt())&&(p++,"number"!=typeof n&&l++),p>e&&p<=l)d+=g;else if(p!==e||h||void 0===u){if(p>=l){d+=c(a,!0,u);break}}else d=c(a)}return d}},510:(t,e,n)=>{"use strict";const r=n(379);t.exports=t=>"string"==typeof t?t.replace(r(),""):t},755:t=>{t.exports=function t(e,n){if(e&&n)return t(e)(n);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach((function(t){r[t]=e[t]})),r;function r(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];var r=e.apply(this,t),i=t[t.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(t){r[t]=i[t]})),r}}},357:t=>{"use strict";t.exports=require("assert")},614:t=>{"use strict";t.exports=require("events")},747:t=>{"use strict";t.exports=require("fs")},622:t=>{"use strict";t.exports=require("path")},669:t=>{"use strict";t.exports=require("util")}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={id:r,loaded:!1,exports:{}};return t[r](o,o.exports,n),o.loaded=!0,o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var r={};(()=>{"use strict";n.r(r),n.d(r,{default:()=>rn});const t=require("@yarnpkg/cli");var e=n(747),i=n.n(e);const o=require("@yarnpkg/core"),s=require("@yarnpkg/libzip"),a=require("@yarnpkg/fslib"),c=require("clipanion");var u=n(622),l=n.n(u);const h=async t=>{try{return(0,e.readFileSync)(t,"utf-8").split("\n")}catch(t){return[]}};var p=n(770),d=n.n(p),f=n(102),g=n.n(f);const m=async({exclude:t,ignoreFile:e,cwd:n})=>{const r=(({ignoreFile:t,cwd:e})=>(0,u.join)(e,t))({ignoreFile:e,cwd:n}),i=d()().add([...t,...await h(r)]);return(await(async({cwd:t})=>{try{return(await g()(t+"/**/*",{dot:!0})).map(e=>{var n;return null!==(n=e.split(t+"/")[1])&&void 0!==n?n:""}).filter(Boolean)}catch(t){return[]}})({cwd:n})).filter(t=>i.ignores(t)).map(t=>`${n}/${t}`)},v=["package.json","package.yaml","package.yml"],y={directory:({cwd:t})=>[t],parentDirectories:({cwd:t,rootDir:e})=>{if(!t.startsWith(e))throw new Error("Package directory not in rootDir. This should never happen");let n=t,r=[];for(;;){if(n===e||n.length<e.length)return r;n=(0,u.dirname)(n),r=[...r,n]}},packageFiles:({cwd:t})=>v.map(e=>(0,u.join)(t,e))},b=({workspaces:t,rootDir:e})=>Array.from(t).map(({cwd:t})=>(({cwd:t,rootDir:e})=>[...new Set(...[Object.values(y).map(n=>n({cwd:t,rootDir:e})).flat()])])({cwd:t,rootDir:e})).flat(),w=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function k({test:t}){return(e=t,()=>e)();var e}function C(t){return null===t?"null":void 0===t?"undefined":""===t?"an empty string":JSON.stringify(t)}function _(t,e){var n,r,i;return"number"==typeof e?`${null!==(n=null==t?void 0:t.p)&&void 0!==n?n:"."}[${e}]`:w.test(e)?`${null!==(r=null==t?void 0:t.p)&&void 0!==r?r:""}.${e}`:`${null!==(i=null==t?void 0:t.p)&&void 0!==i?i:"."}[${JSON.stringify(e)}]`}function x(t,e){return n=>{const r=t[e];return t[e]=n,x(t,e).bind(null,r)}}function E(t,e){return n=>{t[e]=n}}function I({errors:t,p:e}={},n){return null==t||t.push(`${null!=e?e:"."}: ${n}`),!1}const R=()=>k({test:(t,e)=>"string"==typeof t||I(e,`Expected a string (got ${C(t)})`)});const S=new Map([["true",!0],["True",!0],["1",!0],[1,!0],["false",!1],["False",!1],["0",!1],[0,!1]]),A=(t,{extra:e=null}={})=>{const n=Object.keys(t);return k({test:(r,i)=>{if("object"!=typeof r||null===r)return I(i,`Expected an object (got ${C(r)})`);const o=new Set([...n,...Object.keys(r)]),s={};let a=!0;for(const n of o){if("constructor"===n||"__proto__"===n)a=I(Object.assign(Object.assign({},i),{p:_(i,n)}),"Unsafe property name");else{const o=Object.prototype.hasOwnProperty.call(t,n)?t[n]:void 0,c=Object.prototype.hasOwnProperty.call(r,n)?r[n]:void 0;void 0!==o?a=o(c,Object.assign(Object.assign({},i),{p:_(i,n),coercion:x(r,n)}))&&a:null===e?a=I(Object.assign(Object.assign({},i),{p:_(i,n)}),`Extraneous property (got ${C(c)})`):Object.defineProperty(s,n,{enumerable:!0,get:()=>c,set:E(r,n)})}if(!a&&null==(null==i?void 0:i.errors))break}return null===e||!a&&null==(null==i?void 0:i.errors)||(a=e(s,i)&&a),a}})};var O;!function(t){t.Forbids="Forbids",t.Requires="Requires"}(O||(O={}));O.Forbids,O.Requires;
/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */
function j(t){return null==t}var T={isNothing:j,isObject:function(t){return"object"==typeof t&&null!==t},toArray:function(t){return Array.isArray(t)?t:j(t)?[]:[t]},repeat:function(t,e){var n,r="";for(n=0;n<e;n+=1)r+=t;return r},isNegativeZero:function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},extend:function(t,e){var n,r,i,o;if(e)for(n=0,r=(o=Object.keys(e)).length;n<r;n+=1)t[i=o[n]]=e[i];return t}};function $(t,e){var n="",r=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(n+='in "'+t.mark.name+'" '),n+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(n+="\n\n"+t.mark.snippet),r+" "+n):r}function M(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=$(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}M.prototype=Object.create(Error.prototype),M.prototype.constructor=M,M.prototype.toString=function(t){return this.name+": "+$(this,t)};var L=M;function N(t,e,n,r,i){var o="",s="",a=Math.floor(i/2)-1;return r-e>a&&(e=r-a+(o=" ... ").length),n-r>a&&(n=r+a-(s=" ...").length),{str:o+t.slice(e,n).replace(/\t/g,"→")+s,pos:r-e+o.length}}function P(t,e){return T.repeat(" ",e-t.length)+t}var D=function(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),"number"!=typeof e.indent&&(e.indent=1),"number"!=typeof e.linesBefore&&(e.linesBefore=3),"number"!=typeof e.linesAfter&&(e.linesAfter=2);for(var n,r=/\r?\n|\r|\0/g,i=[0],o=[],s=-1;n=r.exec(t.buffer);)o.push(n.index),i.push(n.index+n[0].length),t.position<=n.index&&s<0&&(s=i.length-2);s<0&&(s=i.length-1);var a,c,u="",l=Math.min(t.line+e.linesAfter,o.length).toString().length,h=e.maxLength-(e.indent+l+3);for(a=1;a<=e.linesBefore&&!(s-a<0);a++)c=N(t.buffer,i[s-a],o[s-a],t.position-(i[s]-i[s-a]),h),u=T.repeat(" ",e.indent)+P((t.line-a+1).toString(),l)+" | "+c.str+"\n"+u;for(c=N(t.buffer,i[s],o[s],t.position,h),u+=T.repeat(" ",e.indent)+P((t.line+1).toString(),l)+" | "+c.str+"\n",u+=T.repeat("-",e.indent+l+3+c.pos)+"^\n",a=1;a<=e.linesAfter&&!(s+a>=o.length);a++)c=N(t.buffer,i[s+a],o[s+a],t.position-(i[s]-i[s+a]),h),u+=T.repeat(" ",e.indent)+P((t.line+a+1).toString(),l)+" | "+c.str+"\n";return u.replace(/\n$/,"")},B=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],U=["scalar","sequence","mapping"];var F=function(t,e){if(e=e||{},Object.keys(e).forEach((function(e){if(-1===B.indexOf(e))throw new L('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=function(t){var e={};return null!==t&&Object.keys(t).forEach((function(n){t[n].forEach((function(t){e[String(t)]=n}))})),e}(e.styleAliases||null),-1===U.indexOf(this.kind))throw new L('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function q(t,e){var n=[];return t[e].forEach((function(t){var e=n.length;n.forEach((function(n,r){n.tag===t.tag&&n.kind===t.kind&&n.multi===t.multi&&(e=r)})),n[e]=t})),n}function G(t){return this.extend(t)}G.prototype.extend=function(t){var e=[],n=[];if(t instanceof F)n.push(t);else if(Array.isArray(t))n=n.concat(t);else{if(!t||!Array.isArray(t.implicit)&&!Array.isArray(t.explicit))throw new L("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.implicit&&(e=e.concat(t.implicit)),t.explicit&&(n=n.concat(t.explicit))}e.forEach((function(t){if(!(t instanceof F))throw new L("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&"scalar"!==t.loadKind)throw new L("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new L("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(t){if(!(t instanceof F))throw new L("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var r=Object.create(G.prototype);return r.implicit=(this.implicit||[]).concat(e),r.explicit=(this.explicit||[]).concat(n),r.compiledImplicit=q(r,"implicit"),r.compiledExplicit=q(r,"explicit"),r.compiledTypeMap=function(){var t,e,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function r(t){t.multi?(n.multi[t.kind].push(t),n.multi.fallback.push(t)):n[t.kind][t.tag]=n.fallback[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(r);return n}(r.compiledImplicit,r.compiledExplicit),r};var z=G,W=new F("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),Q=new F("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),Y=new F("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}}),J=new z({explicit:[W,Q,Y]});var H=new F("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var Z=new F("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function K(t){return 48<=t&&t<=55}function V(t){return 48<=t&&t<=57}var X=new F("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,r=t.length,i=0,o=!1;if(!r)return!1;if("-"!==(e=t[i])&&"+"!==e||(e=t[++i]),"0"===e){if(i+1===r)return!0;if("b"===(e=t[++i])){for(i++;i<r;i++)if("_"!==(e=t[i])){if("0"!==e&&"1"!==e)return!1;o=!0}return o&&"_"!==e}if("x"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!(48<=(n=t.charCodeAt(i))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;o=!0}return o&&"_"!==e}if("o"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!K(t.charCodeAt(i)))return!1;o=!0}return o&&"_"!==e}}if("_"===e)return!1;for(;i<r;i++)if("_"!==(e=t[i])){if(!V(t.charCodeAt(i)))return!1;o=!0}return!(!o||"_"===e)},construct:function(t){var e,n=t,r=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(e=n[0])&&"+"!==e||("-"===e&&(r=-1),e=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===e){if("b"===n[1])return r*parseInt(n.slice(2),2);if("x"===n[1])return r*parseInt(n.slice(2),16);if("o"===n[1])return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!T.isNegativeZero(t)},represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),tt=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var et=/^[-+]?[0-9]+e/;var nt=new F("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!(!tt.test(t)||"_"===t[t.length-1])},construct:function(t){var e,n;return n="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:n*parseFloat(e,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||T.isNegativeZero(t))},represent:function(t,e){var n;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(T.isNegativeZero(t))return"-0.0";return n=t.toString(10),et.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"}),rt=J.extend({implicit:[H,Z,X,nt]}),it=rt,ot=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),st=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var at=new F("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&(null!==ot.exec(t)||null!==st.exec(t))},construct:function(t){var e,n,r,i,o,s,a,c,u=0,l=null;if(null===(e=ot.exec(t))&&(e=st.exec(t)),null===e)throw new Error("Date resolve error");if(n=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(n,r,i));if(o=+e[4],s=+e[5],a=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(l=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(l=-l)),c=new Date(Date.UTC(n,r,i,o,s,a,u)),l&&c.setTime(c.getTime()-l),c},instanceOf:Date,represent:function(t){return t.toISOString()}});var ct=new F("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),ut="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var lt=new F("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,r=0,i=t.length,o=ut;for(n=0;n<i;n++)if(!((e=o.indexOf(t.charAt(n)))>64)){if(e<0)return!1;r+=6}return r%8==0},construct:function(t){var e,n,r=t.replace(/[\r\n=]/g,""),i=r.length,o=ut,s=0,a=[];for(e=0;e<i;e++)e%4==0&&e&&(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)),s=s<<6|o.indexOf(r.charAt(e));return 0===(n=i%4*6)?(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)):18===n?(a.push(s>>10&255),a.push(s>>2&255)):12===n&&a.push(s>>4&255),new Uint8Array(a)},predicate:function(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)},represent:function(t){var e,n,r="",i=0,o=t.length,s=ut;for(e=0;e<o;e++)e%3==0&&e&&(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]),i=(i<<8)+t[e];return 0===(n=o%3)?(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]):2===n?(r+=s[i>>10&63],r+=s[i>>4&63],r+=s[i<<2&63],r+=s[64]):1===n&&(r+=s[i>>2&63],r+=s[i<<4&63],r+=s[64],r+=s[64]),r}}),ht=Object.prototype.hasOwnProperty,pt=Object.prototype.toString;var dt=new F("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,r,i,o,s=[],a=t;for(e=0,n=a.length;e<n;e+=1){if(r=a[e],o=!1,"[object Object]"!==pt.call(r))return!1;for(i in r)if(ht.call(r,i)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==s.indexOf(i))return!1;s.push(i)}return!0},construct:function(t){return null!==t?t:[]}}),ft=Object.prototype.toString;var gt=new F("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,r,i,o,s=t;for(o=new Array(s.length),e=0,n=s.length;e<n;e+=1){if(r=s[e],"[object Object]"!==ft.call(r))return!1;if(1!==(i=Object.keys(r)).length)return!1;o[e]=[i[0],r[i[0]]]}return!0},construct:function(t){if(null===t)return[];var e,n,r,i,o,s=t;for(o=new Array(s.length),e=0,n=s.length;e<n;e+=1)r=s[e],i=Object.keys(r),o[e]=[i[0],r[i[0]]];return o}}),mt=Object.prototype.hasOwnProperty;var vt=new F("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,n=t;for(e in n)if(mt.call(n,e)&&null!==n[e])return!1;return!0},construct:function(t){return null!==t?t:{}}}),yt=it.extend({implicit:[at,ct],explicit:[lt,dt,gt,vt]}),bt=Object.prototype.hasOwnProperty,wt=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,kt=/[\x85\u2028\u2029]/,Ct=/[,\[\]\{\}]/,_t=/^(?:!|!!|![a-z\-]+!)$/i,xt=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Et(t){return Object.prototype.toString.call(t)}function It(t){return 10===t||13===t}function Rt(t){return 9===t||32===t}function St(t){return 9===t||32===t||10===t||13===t}function At(t){return 44===t||91===t||93===t||123===t||125===t}function Ot(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function jt(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?" ":76===t?"\u2028":80===t?"\u2029":""}function Tt(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var $t=new Array(256),Mt=new Array(256),Lt=0;Lt<256;Lt++)$t[Lt]=jt(Lt)?1:0,Mt[Lt]=jt(Lt);function Nt(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||yt,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Pt(t,e){var n={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return n.snippet=D(n),new L(e,n)}function Dt(t,e){throw Pt(t,e)}function Bt(t,e){t.onWarning&&t.onWarning.call(null,Pt(t,e))}var Ut={YAML:function(t,e,n){var r,i,o;null!==t.version&&Dt(t,"duplication of %YAML directive"),1!==n.length&&Dt(t,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&Dt(t,"ill-formed argument of the YAML directive"),i=parseInt(r[1],10),o=parseInt(r[2],10),1!==i&&Dt(t,"unacceptable YAML version of the document"),t.version=n[0],t.checkLineBreaks=o<2,1!==o&&2!==o&&Bt(t,"unsupported YAML version of the document")},TAG:function(t,e,n){var r,i;2!==n.length&&Dt(t,"TAG directive accepts exactly two arguments"),r=n[0],i=n[1],_t.test(r)||Dt(t,"ill-formed tag handle (first argument) of the TAG directive"),bt.call(t.tagMap,r)&&Dt(t,'there is a previously declared suffix for "'+r+'" tag handle'),xt.test(i)||Dt(t,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch(e){Dt(t,"tag prefix is malformed: "+i)}t.tagMap[r]=i}};function Ft(t,e,n,r){var i,o,s,a;if(e<n){if(a=t.input.slice(e,n),r)for(i=0,o=a.length;i<o;i+=1)9===(s=a.charCodeAt(i))||32<=s&&s<=1114111||Dt(t,"expected valid JSON character");else wt.test(a)&&Dt(t,"the stream contains non-printable characters");t.result+=a}}function qt(t,e,n,r){var i,o,s,a;for(T.isObject(n)||Dt(t,"cannot merge mappings; the provided source object is unacceptable"),s=0,a=(i=Object.keys(n)).length;s<a;s+=1)o=i[s],bt.call(e,o)||(e[o]=n[o],r[o]=!0)}function Gt(t,e,n,r,i,o,s,a,c){var u,l;if(Array.isArray(i))for(u=0,l=(i=Array.prototype.slice.call(i)).length;u<l;u+=1)Array.isArray(i[u])&&Dt(t,"nested arrays are not supported inside keys"),"object"==typeof i&&"[object Object]"===Et(i[u])&&(i[u]="[object Object]");if("object"==typeof i&&"[object Object]"===Et(i)&&(i="[object Object]"),i=String(i),null===e&&(e={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(u=0,l=o.length;u<l;u+=1)qt(t,e,o[u],n);else qt(t,e,o,n);else t.json||bt.call(n,i)||!bt.call(e,i)||(t.line=s||t.line,t.lineStart=a||t.lineStart,t.position=c||t.position,Dt(t,"duplicated mapping key")),"__proto__"===i?Object.defineProperty(e,i,{configurable:!0,enumerable:!0,writable:!0,value:o}):e[i]=o,delete n[i];return e}function zt(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):Dt(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function Wt(t,e,n){for(var r=0,i=t.input.charCodeAt(t.position);0!==i;){for(;Rt(i);)9===i&&-1===t.firstTabInLine&&(t.firstTabInLine=t.position),i=t.input.charCodeAt(++t.position);if(e&&35===i)do{i=t.input.charCodeAt(++t.position)}while(10!==i&&13!==i&&0!==i);if(!It(i))break;for(zt(t),i=t.input.charCodeAt(t.position),r++,t.lineIndent=0;32===i;)t.lineIndent++,i=t.input.charCodeAt(++t.position)}return-1!==n&&0!==r&&t.lineIndent<n&&Bt(t,"deficient indentation"),r}function Qt(t){var e,n=t.position;return!(45!==(e=t.input.charCodeAt(n))&&46!==e||e!==t.input.charCodeAt(n+1)||e!==t.input.charCodeAt(n+2)||(n+=3,0!==(e=t.input.charCodeAt(n))&&!St(e)))}function Yt(t,e){1===e?t.result+=" ":e>1&&(t.result+=T.repeat("\n",e-1))}function Jt(t,e){var n,r,i=t.tag,o=t.anchor,s=[],a=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=s),r=t.input.charCodeAt(t.position);0!==r&&(-1!==t.firstTabInLine&&(t.position=t.firstTabInLine,Dt(t,"tab characters must not be used in indentation")),45===r)&&St(t.input.charCodeAt(t.position+1));)if(a=!0,t.position++,Wt(t,!0,-1)&&t.lineIndent<=e)s.push(null),r=t.input.charCodeAt(t.position);else if(n=t.line,Kt(t,e,3,!1,!0),s.push(t.result),Wt(t,!0,-1),r=t.input.charCodeAt(t.position),(t.line===n||t.lineIndent>e)&&0!==r)Dt(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!a&&(t.tag=i,t.anchor=o,t.kind="sequence",t.result=s,!0)}function Ht(t){var e,n,r,i,o=!1,s=!1;if(33!==(i=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&Dt(t,"duplication of a tag property"),60===(i=t.input.charCodeAt(++t.position))?(o=!0,i=t.input.charCodeAt(++t.position)):33===i?(s=!0,n="!!",i=t.input.charCodeAt(++t.position)):n="!",e=t.position,o){do{i=t.input.charCodeAt(++t.position)}while(0!==i&&62!==i);t.position<t.length?(r=t.input.slice(e,t.position),i=t.input.charCodeAt(++t.position)):Dt(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==i&&!St(i);)33===i&&(s?Dt(t,"tag suffix cannot contain exclamation marks"):(n=t.input.slice(e-1,t.position+1),_t.test(n)||Dt(t,"named tag handle cannot contain such characters"),s=!0,e=t.position+1)),i=t.input.charCodeAt(++t.position);r=t.input.slice(e,t.position),Ct.test(r)&&Dt(t,"tag suffix cannot contain flow indicator characters")}r&&!xt.test(r)&&Dt(t,"tag name cannot contain such characters: "+r);try{r=decodeURIComponent(r)}catch(e){Dt(t,"tag name is malformed: "+r)}return o?t.tag=r:bt.call(t.tagMap,n)?t.tag=t.tagMap[n]+r:"!"===n?t.tag="!"+r:"!!"===n?t.tag="tag:yaml.org,2002:"+r:Dt(t,'undeclared tag handle "'+n+'"'),!0}function Zt(t){var e,n;if(38!==(n=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&Dt(t,"duplication of an anchor property"),n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!St(n)&&!At(n);)n=t.input.charCodeAt(++t.position);return t.position===e&&Dt(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function Kt(t,e,n,r,i){var o,s,a,c,u,l,h,p,d,f=1,g=!1,m=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=s=a=4===n||3===n,r&&Wt(t,!0,-1)&&(g=!0,t.lineIndent>e?f=1:t.lineIndent===e?f=0:t.lineIndent<e&&(f=-1)),1===f)for(;Ht(t)||Zt(t);)Wt(t,!0,-1)?(g=!0,a=o,t.lineIndent>e?f=1:t.lineIndent===e?f=0:t.lineIndent<e&&(f=-1)):a=!1;if(a&&(a=g||i),1!==f&&4!==n||(p=1===n||2===n?e:e+1,d=t.position-t.lineStart,1===f?a&&(Jt(t,d)||function(t,e,n){var r,i,o,s,a,c,u,l=t.tag,h=t.anchor,p={},d=Object.create(null),f=null,g=null,m=null,v=!1,y=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=p),u=t.input.charCodeAt(t.position);0!==u;){if(v||-1===t.firstTabInLine||(t.position=t.firstTabInLine,Dt(t,"tab characters must not be used in indentation")),r=t.input.charCodeAt(t.position+1),o=t.line,63!==u&&58!==u||!St(r)){if(s=t.line,a=t.lineStart,c=t.position,!Kt(t,n,2,!1,!0))break;if(t.line===o){for(u=t.input.charCodeAt(t.position);Rt(u);)u=t.input.charCodeAt(++t.position);if(58===u)St(u=t.input.charCodeAt(++t.position))||Dt(t,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(Gt(t,p,d,f,g,null,s,a,c),f=g=m=null),y=!0,v=!1,i=!1,f=t.tag,g=t.result;else{if(!y)return t.tag=l,t.anchor=h,!0;Dt(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return t.tag=l,t.anchor=h,!0;Dt(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(v&&(Gt(t,p,d,f,g,null,s,a,c),f=g=m=null),y=!0,v=!0,i=!0):v?(v=!1,i=!0):Dt(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,u=r;if((t.line===o||t.lineIndent>e)&&(v&&(s=t.line,a=t.lineStart,c=t.position),Kt(t,e,4,!0,i)&&(v?g=t.result:m=t.result),v||(Gt(t,p,d,f,g,m,s,a,c),f=g=m=null),Wt(t,!0,-1),u=t.input.charCodeAt(t.position)),(t.line===o||t.lineIndent>e)&&0!==u)Dt(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return v&&Gt(t,p,d,f,g,null,s,a,c),y&&(t.tag=l,t.anchor=h,t.kind="mapping",t.result=p),y}(t,d,p))||function(t,e){var n,r,i,o,s,a,c,u,l,h,p,d,f=!0,g=t.tag,m=t.anchor,v=Object.create(null);if(91===(d=t.input.charCodeAt(t.position)))s=93,u=!1,o=[];else{if(123!==d)return!1;s=125,u=!0,o={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=o),d=t.input.charCodeAt(++t.position);0!==d;){if(Wt(t,!0,e),(d=t.input.charCodeAt(t.position))===s)return t.position++,t.tag=g,t.anchor=m,t.kind=u?"mapping":"sequence",t.result=o,!0;f?44===d&&Dt(t,"expected the node content, but found ','"):Dt(t,"missed comma between flow collection entries"),p=null,a=c=!1,63===d&&St(t.input.charCodeAt(t.position+1))&&(a=c=!0,t.position++,Wt(t,!0,e)),n=t.line,r=t.lineStart,i=t.position,Kt(t,e,1,!1,!0),h=t.tag,l=t.result,Wt(t,!0,e),d=t.input.charCodeAt(t.position),!c&&t.line!==n||58!==d||(a=!0,d=t.input.charCodeAt(++t.position),Wt(t,!0,e),Kt(t,e,1,!1,!0),p=t.result),u?Gt(t,o,v,h,l,p,n,r,i):a?o.push(Gt(t,null,v,h,l,p,n,r,i)):o.push(l),Wt(t,!0,e),44===(d=t.input.charCodeAt(t.position))?(f=!0,d=t.input.charCodeAt(++t.position)):f=!1}Dt(t,"unexpected end of the stream within a flow collection")}(t,p)?m=!0:(s&&function(t,e){var n,r,i,o,s,a=1,c=!1,u=!1,l=e,h=0,p=!1;if(124===(o=t.input.charCodeAt(t.position)))r=!1;else{if(62!==o)return!1;r=!0}for(t.kind="scalar",t.result="";0!==o;)if(43===(o=t.input.charCodeAt(++t.position))||45===o)1===a?a=43===o?3:2:Dt(t,"repeat of a chomping mode identifier");else{if(!((i=48<=(s=o)&&s<=57?s-48:-1)>=0))break;0===i?Dt(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?Dt(t,"repeat of an indentation width identifier"):(l=e+i-1,u=!0)}if(Rt(o)){do{o=t.input.charCodeAt(++t.position)}while(Rt(o));if(35===o)do{o=t.input.charCodeAt(++t.position)}while(!It(o)&&0!==o)}for(;0!==o;){for(zt(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!u||t.lineIndent<l)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!u&&t.lineIndent>l&&(l=t.lineIndent),It(o))h++;else{if(t.lineIndent<l){3===a?t.result+=T.repeat("\n",c?1+h:h):1===a&&c&&(t.result+="\n");break}for(r?Rt(o)?(p=!0,t.result+=T.repeat("\n",c?1+h:h)):p?(p=!1,t.result+=T.repeat("\n",h+1)):0===h?c&&(t.result+=" "):t.result+=T.repeat("\n",h):t.result+=T.repeat("\n",c?1+h:h),c=!0,u=!0,h=0,n=t.position;!It(o)&&0!==o;)o=t.input.charCodeAt(++t.position);Ft(t,n,t.position,!1)}}return!0}(t,p)||function(t,e){var n,r,i;if(39!==(n=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,r=i=t.position;0!==(n=t.input.charCodeAt(t.position));)if(39===n){if(Ft(t,r,t.position,!0),39!==(n=t.input.charCodeAt(++t.position)))return!0;r=t.position,t.position++,i=t.position}else It(n)?(Ft(t,r,i,!0),Yt(t,Wt(t,!1,e)),r=i=t.position):t.position===t.lineStart&&Qt(t)?Dt(t,"unexpected end of the document within a single quoted scalar"):(t.position++,i=t.position);Dt(t,"unexpected end of the stream within a single quoted scalar")}(t,p)||function(t,e){var n,r,i,o,s,a,c;if(34!==(a=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,n=r=t.position;0!==(a=t.input.charCodeAt(t.position));){if(34===a)return Ft(t,n,t.position,!0),t.position++,!0;if(92===a){if(Ft(t,n,t.position,!0),It(a=t.input.charCodeAt(++t.position)))Wt(t,!1,e);else if(a<256&&$t[a])t.result+=Mt[a],t.position++;else if((s=120===(c=a)?2:117===c?4:85===c?8:0)>0){for(i=s,o=0;i>0;i--)(s=Ot(a=t.input.charCodeAt(++t.position)))>=0?o=(o<<4)+s:Dt(t,"expected hexadecimal character");t.result+=Tt(o),t.position++}else Dt(t,"unknown escape sequence");n=r=t.position}else It(a)?(Ft(t,n,r,!0),Yt(t,Wt(t,!1,e)),n=r=t.position):t.position===t.lineStart&&Qt(t)?Dt(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}Dt(t,"unexpected end of the stream within a double quoted scalar")}(t,p)?m=!0:!function(t){var e,n,r;if(42!==(r=t.input.charCodeAt(t.position)))return!1;for(r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!St(r)&&!At(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&Dt(t,"name of an alias node must contain at least one character"),n=t.input.slice(e,t.position),bt.call(t.anchorMap,n)||Dt(t,'unidentified alias "'+n+'"'),t.result=t.anchorMap[n],Wt(t,!0,-1),!0}(t)?function(t,e,n){var r,i,o,s,a,c,u,l,h=t.kind,p=t.result;if(St(l=t.input.charCodeAt(t.position))||At(l)||35===l||38===l||42===l||33===l||124===l||62===l||39===l||34===l||37===l||64===l||96===l)return!1;if((63===l||45===l)&&(St(r=t.input.charCodeAt(t.position+1))||n&&At(r)))return!1;for(t.kind="scalar",t.result="",i=o=t.position,s=!1;0!==l;){if(58===l){if(St(r=t.input.charCodeAt(t.position+1))||n&&At(r))break}else if(35===l){if(St(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&Qt(t)||n&&At(l))break;if(It(l)){if(a=t.line,c=t.lineStart,u=t.lineIndent,Wt(t,!1,-1),t.lineIndent>=e){s=!0,l=t.input.charCodeAt(t.position);continue}t.position=o,t.line=a,t.lineStart=c,t.lineIndent=u;break}}s&&(Ft(t,i,o,!1),Yt(t,t.line-a),i=o=t.position,s=!1),Rt(l)||(o=t.position+1),l=t.input.charCodeAt(++t.position)}return Ft(t,i,o,!1),!!t.result||(t.kind=h,t.result=p,!1)}(t,p,1===n)&&(m=!0,null===t.tag&&(t.tag="?")):(m=!0,null===t.tag&&null===t.anchor||Dt(t,"alias node should not have any properties")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===f&&(m=a&&Jt(t,d))),null===t.tag)null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);else if("?"===t.tag){for(null!==t.result&&"scalar"!==t.kind&&Dt(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),c=0,u=t.implicitTypes.length;c<u;c+=1)if((h=t.implicitTypes[c]).resolve(t.result)){t.result=h.construct(t.result),t.tag=h.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else if("!"!==t.tag){if(bt.call(t.typeMap[t.kind||"fallback"],t.tag))h=t.typeMap[t.kind||"fallback"][t.tag];else for(h=null,c=0,u=(l=t.typeMap.multi[t.kind||"fallback"]).length;c<u;c+=1)if(t.tag.slice(0,l[c].tag.length)===l[c].tag){h=l[c];break}h||Dt(t,"unknown tag !<"+t.tag+">"),null!==t.result&&h.kind!==t.kind&&Dt(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+h.kind+'", not "'+t.kind+'"'),h.resolve(t.result,t.tag)?(t.result=h.construct(t.result,t.tag),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):Dt(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||m}function Vt(t){var e,n,r,i,o=t.position,s=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);0!==(i=t.input.charCodeAt(t.position))&&(Wt(t,!0,-1),i=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==i));){for(s=!0,i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!St(i);)i=t.input.charCodeAt(++t.position);for(r=[],(n=t.input.slice(e,t.position)).length<1&&Dt(t,"directive name must not be less than one character in length");0!==i;){for(;Rt(i);)i=t.input.charCodeAt(++t.position);if(35===i){do{i=t.input.charCodeAt(++t.position)}while(0!==i&&!It(i));break}if(It(i))break;for(e=t.position;0!==i&&!St(i);)i=t.input.charCodeAt(++t.position);r.push(t.input.slice(e,t.position))}0!==i&&zt(t),bt.call(Ut,n)?Ut[n](t,n,r):Bt(t,'unknown document directive "'+n+'"')}Wt(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,Wt(t,!0,-1)):s&&Dt(t,"directives end mark is expected"),Kt(t,t.lineIndent-1,4,!1,!0),Wt(t,!0,-1),t.checkLineBreaks&&kt.test(t.input.slice(o,t.position))&&Bt(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&Qt(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,Wt(t,!0,-1)):t.position<t.length-1&&Dt(t,"end of the stream or a document separator is expected")}function Xt(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var n=new Nt(t,e),r=t.indexOf("\0");for(-1!==r&&(n.position=r,Dt(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Vt(n);return n.documents}var te={loadAll:function(t,e,n){null!==e&&"object"==typeof e&&void 0===n&&(n=e,e=null);var r=Xt(t,n);if("function"!=typeof e)return r;for(var i=0,o=r.length;i<o;i+=1)e(r[i])},load:function(t,e){var n=Xt(t,e);if(0!==n.length){if(1===n.length)return n[0];throw new L("expected a single document in the stream, but found more")}}};Object.prototype.toString,Object.prototype.hasOwnProperty;function ee(t,e){return function(){throw new Error("Function yaml."+t+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var ne=rt,re=te.load;ee("safeLoad","load"),ee("safeLoadAll","loadAll"),ee("safeDump","dump");const ie=A({folders:A({input:R(),output:R()}),exclude:((t,{delimiter:e}={})=>k({test:(n,r)=>{var i;if("string"==typeof n&&void 0!==e&&void 0!==(null==r?void 0:r.coercions)){if(void 0===(null==r?void 0:r.coercion))return I(r,"Unbound coercion result");n=n.split(e),r.coercions.push([null!==(i=r.p)&&void 0!==i?i:".",r.coercion.bind(null,n)])}if(!Array.isArray(n))return I(r,`Expected an array (got ${C(n)})`);let o=!0;for(let e=0,i=n.length;e<i&&(o=t(n[e],Object.assign(Object.assign({},r),{p:_(r,e),coercion:x(n,e)}))&&o,o||null!=(null==r?void 0:r.errors));++e);return o}}))(R()),bail:k({test:(t,e)=>{var n;if("boolean"!=typeof t){if(void 0!==(null==e?void 0:e.coercions)){if(void 0===(null==e?void 0:e.coercion))return I(e,"Unbound coercion result");const r=S.get(t);if(void 0!==r)return e.coercions.push([null!==(n=e.p)&&void 0!==n?n:".",e.coercion.bind(null,r)]),!0}return I(e,`Expected a boolean (got ${C(t)})`)}return!0}}),ignoreFile:R(),maxConcurrency:(t=>k({test:(e,n)=>void 0===e||t(e,n)}))((oe=k({test:(t,e)=>{var n;if("number"!=typeof t){if(void 0!==(null==e?void 0:e.coercions)){if(void 0===(null==e?void 0:e.coercion))return I(e,"Unbound coercion result");let r;if("string"==typeof t){let n;try{n=JSON.parse(t)}catch(t){}if("number"==typeof n){if(JSON.stringify(n)!==t)return I(e,`Received a number that can't be safely represented by the runtime (${t})`);r=n}}if(void 0!==r)return e.coercions.push([null!==(n=e.p)&&void 0!==n?n:".",e.coercion.bind(null,r)]),!0}return I(e,`Expected a number (got ${C(t)})`)}return!0}}),se=[(({unsafe:t=!1}={})=>k({test:(t,e)=>t!==Math.round(t)?I(e,`Expected to be an integer (got ${t})`):!!Number.isSafeInteger(t)||I(e,`Expected to be a safe integer (got ${t})`)}))(),(ae=1,ce=128,k({test:(t,e)=>t>=ae&&t<=ce||I(e,`Expected to be in the [${ae}; ${ce}] range (got ${t})`)}))],k({test:(t,e)=>{var n,r;const i={value:t},o=void 0!==(null==e?void 0:e.coercions)?x(i,"value"):void 0,s=void 0!==(null==e?void 0:e.coercions)?[]:void 0;if(!oe(t,Object.assign(Object.assign({},e),{coercion:o,coercions:s})))return!1;const a=[];if(void 0!==s)for(const[,t]of s)a.push(t());try{if(void 0!==(null==e?void 0:e.coercions)){if(i.value!==t){if(void 0===(null==e?void 0:e.coercion))return I(e,"Unbound coercion result");e.coercions.push([null!==(n=e.p)&&void 0!==n?n:".",e.coercion.bind(null,i.value)])}null===(r=null==e?void 0:e.coercions)||void 0===r||r.push(...s)}return se.every(t=>t(i.value,e))}finally{for(const t of a)t()}}})))});var oe,se,ae,ce;const ue={folders:{input:".",output:"build"},exclude:[],bail:!1,ignoreFile:".bundleignore",maxConcurrency:8};async function le(t){const e=a.ppath.join(t.projectCwd||t.startingCwd,".yarnbuildrc.yml");if(a.xfs.existsSync(e)){const t=await a.xfs.readFilePromise(e,"utf8"),n=[];try{const e=re(t,{schema:ne});if(ie(e,{errors:n}))return e;console.warn(n)}catch(n){let r="";throw t.match(/^\s+(?!-)[^:]+\s+\S+/m)&&(r=" (config is corrupted, please check it matches the shape in the yarn.build readme."),new Error(`Parse error when loading ${e}; please check it's proper Yaml${r}`)}}return ue}async function he(t){var e;const n=await le(t);return{...ue,...n,folders:{...ue.folders,...null!==(e=n.folders)&&void 0!==e?e:{}}}}class pe extends t.BaseCommand{constructor(){super(...arguments),this.json=c.Option.Boolean("--json",!1,{description:"flag is set the output will follow a JSON-stream output also known as NDJSON (https://github.com/ndjson/ndjson-spec)"}),this.outputDirectory=c.Option.String("-o,--output-directory",{description:"sets the output directory, this should be outside your source input directory."}),this.noCompress=c.Option.Boolean("--no-compress",!1,{description:"set this with --output-directory to skip zipping your bundle, when this is set your output directory must be outside your projecty root"}),this.archiveName=c.Option.String("-a,--archive-name","bundle.zip",{description:"sets the name of the archive. Any files matching this, will be excluded from subsequent archives. Defaults to ./bundle.zip"}),this.exclude=c.Option.Array("--exclude",[],{arity:1,description:"Exclude specific paths from the final bundle."}),this.ignoreFile=c.Option.String("--ignore-file",".bundleignore",{description:"set the name of ignore file. Files matching this in workspace root and package root will be used to indicate which files will be excluded from bundle."})}async removeUnusedPackages(e,n,r){var i;const{project:s,workspace:c}=await o.Project.find(r,n);if(!c)throw new t.WorkspaceRequiredError(s.cwd,n);const u=new Set([c]),l=await async function(t){return await le(t)}(r);this.exclude=l.exclude?[...this.exclude,...l.exclude]:this.exclude,this.ignoreFile=null!==(i=null==l?void 0:l.ignoreFile)&&void 0!==i?i:this.ignoreFile;for(const t of u)for(const e of o.Manifest.hardDependencies)for(const n of t.manifest.getForScope(e).values()){const t=s.tryWorkspaceByDescriptor(n);null!==t&&u.add(t)}for(const t of s.workspaces)u.has(t)||t.cwd!==e&&await a.xfs.removePromise(t.cwd)}async removeEmptyDirectories({cwd:t}){if(!a.xfs.statSync(t).isDirectory())return!1;let e=await a.xfs.readdirPromise(t);for(const n of e)await this.removeEmptyDirectories({cwd:l().join(t,n)});return e=await a.xfs.readdirPromise(t),0===e.length&&(await a.xfs.removePromise(t),!0)}async removeExcluded({tmpDir:t,excluded:e,nonRemovableFiles:n,yarnDirectory:r,cacheDirectory:i,shouldRemoveEmptyDirectories:o=!1}){const s=t+"/.git";try{await a.xfs.lstatPromise(s)&&await a.xfs.removePromise(s)}catch(t){}await Promise.all(e.map(async e=>{if(!e.startsWith(r)&&!e.startsWith(i)&&!n.includes(e)&&e.startsWith(t))try{await a.xfs.lstatPromise(e)&&await a.xfs.removePromise(e)}catch(t){}})),o&&await this.removeEmptyDirectories({cwd:t})}async execute(){return await a.xfs.mktempPromise(async e=>{var n,r,c,u;const h=""+this.context.cwd;let p=a.ppath.join(h,this.archiveName);if("string"==typeof this.outputDirectory){const t=a.ppath.resolve(this.outputDirectory);if(i().existsSync(t)||await a.xfs.mkdirPromise(t),0!=i().readdirSync(t).length)return console.error("ERROR: --output-directory is not empty"),1;p=a.ppath.join(t,this.archiveName)}const d=await o.Configuration.find(this.context.cwd,this.context.plugins);if(null===d.projectCwd)throw new Error("Can't find project directory");const f=h.replace(d.projectCwd,"");let g,v=!1;if(!0===this.noCompress){if("string"!=typeof this.outputDirectory)return console.error("ERROR: you set --no-compress, but did not specify --output-directory"),1;if(g=a.ppath.resolve(this.outputDirectory),g.startsWith(d.projectCwd))return console.error("ERROR: --output-directory is inside project root with --no-compress set.\nThis is no allowed to prevent you destroying your project"),1;v=!0}const y=new a.NodeFS;await a.xfs.copyPromise(e,d.projectCwd,{baseFs:y});const w=`${e}${f}`,k=`${w}/${this.archiveName}`;let C=this.exclude;try{await a.xfs.lstatPromise(k)&&C.push(k)}catch(t){}const _=await o.Configuration.find(w,this.context.plugins),x=await o.Cache.find(_),E=e+"/.yarn",I=x.cwd;await this.removeUnusedPackages(e,w,_);const{project:R,workspace:S}=await o.Project.find(_,w);if(!S)throw new t.WorkspaceRequiredError(R.cwd,w);const A=new Set([S]),O=b({workspaces:R.workspaces,rootDir:e});C=await m({cwd:e,ignoreFile:this.ignoreFile,exclude:C});for(const t of A)for(const e of o.Manifest.hardDependencies)for(const n of t.manifest.getForScope(e).values()){const t=R.tryWorkspaceByDescriptor(n);null!==t&&A.add(t)}for(const t of A){const n=await m({cwd:t.cwd,ignoreFile:this.ignoreFile,exclude:C});await this.removeExcluded({tmpDir:e,excluded:n,nonRemovableFiles:O,yarnDirectory:E,cacheDirectory:I,shouldRemoveEmptyDirectories:!1})}await this.removeExcluded({tmpDir:e,excluded:C,nonRemovableFiles:O,yarnDirectory:E,cacheDirectory:I,shouldRemoveEmptyDirectories:!0});for(const t of R.workspaces)t.manifest.devDependencies.clear(),A.has(t)||(t.manifest.dependencies.clear(),t.manifest.peerDependencies.clear());if(null===(r=null===(n=null==S?void 0:S.manifest)||void 0===n?void 0:n.raw)||void 0===r?void 0:r.main){const t=S.relativeCwd+l().sep+(null===(u=null===(c=null==S?void 0:S.manifest)||void 0===c?void 0:c.raw)||void 0===u?void 0:u.main),n="./.pnp.cjs";a.xfs.writeFilePromise(`${e}${l().sep}entrypoint.js`,de(t,n))}return(await o.StreamReport.start({configuration:_,json:this.json,stdout:this.context.stdout,includeLogs:!0},async t=>{if(await R.install({cache:x,report:t}),v&&void 0!==g)t.reportInfo(null,"Moving build to output directory"),await y.movePromise(e,g);else{const n=await(0,s.getLibzipPromise)();t.reportInfo(null,"Creating archive");const r=new a.ZipFS(p,{create:!0,libzip:n}),i="bundle";t.reportInfo(null,"Copying files to archive"),await r.copyPromise(i,e,{baseFs:y}),r.saveAndClose(),t.reportJson({name:"ArchiveSuccess",message:"Archive created successfuly at ",outputArchive:p})}})).exitCode()})}}pe.paths=[["bundle"]],pe.usage=c.Command.Usage({category:"Build commands",description:"bundle a workspace package into a deployable archive",details:"\n      This command will bundle up the source of the target package along with\n      its dependencies into an archive.\n\n      This is designed to be used for deployment, not for publishing, so\n      everything to run except for a runtime (ie node) is bundled into\n      the archive.\n\n      Call this after you have run your build step (if any).\n\n      This is designed to work best with zero-install configurations. If you\n      don't have that, run `yarn install` before this command.\n\n      Why not just compile like we do on the front-end?\n      Some dependencies may use require in interesting ways, or be or call\n      binaries. It's safest not to transpile them.\n    "});const de=(t,e)=>`\n"use strict";\n\nconst pnp = require("${e}").setup();\n\nconst index = require("./${t}");\n\nObject.defineProperty(exports, "__esModule", { value: true });\n\nexports.default = index;\n`;var fe=n(76),ge=n.n(fe);const me=require("os");var ve=n(614),ye=n(804),be=n(251),we=n.n(be),ke=n(626),Ce=n(510),_e=n.n(Ce),xe=n(52),Ee=n.n(xe);class Ie{constructor(){this.nodes={},this.size=0,this.runSize=0,this.ran=new Set}addNode(t){if(this.nodes[t])return this.nodes[t];const e=new Re(t,this);return this.nodes[t]=e,this.size++,e}getNode(t){if(this.nodes[t])return this.nodes[t]}resetRuns(){this.ran=new Set}async resolve(t){const e=new Set,n=new Set;await this.resolveNode(t,e,n)}async resolveNode(t,e,n){n.add(t.id);for(const r of t.dependencies)if(!e.has(r.id)){if(n.has(r.id))throw new Se(`${t.id} has a cyclic dependency on ${r.id}`);await this.resolveNode(r,e,n)}e.add(t.id),n.delete(t.id)}async run(t){const e=new Set,n=new Set,r={};for(const n of t)this.resolveQueue(n,e,r);return await new Promise(t=>{this.workLoop(e,r,n,t)}),r}workLoop(t,e,n,r){0!==t.size&&t.forEach(r=>{var i,o;r.canStart(e)&&((null===(i=null==r?void 0:r.node)||void 0===i?void 0:i.runCallback)?(null===(o=null==r?void 0:r.node)||void 0===o||o.runCallback(e),n.add(r.node)):e[r.node.id]={success:!0,done:!0},t.delete(r))}),n.forEach((t,r)=>{e[t.id].done&&n.delete(r)}),Object.keys(e).map(t=>{var n,r;return null===(r=null===(n=e[t])||void 0===n?void 0:n.done)||void 0===r||r}).every(t=>!0===t)?r():setTimeout(()=>this.workLoop(t,e,n,r),30)}resolveQueue(t,e,n){const r=[];for(const i of t.dependencies)if(r.push(i.id),!n[i.id]&&i.runCallback){n[i.id]={...Ie.RunLogInit};const t=this.resolveQueue(i,e,n),r={node:i,canStart:Ie.QueueItemCanStart(t)};e.add(r)}if(!n[t.id]&&t.runCallback){n[t.id]={...Ie.RunLogInit};const i={node:t,canStart:Ie.QueueItemCanStart(r)};e.add(i)}return r}}Ie.RunLogInit={success:!1,done:!1},Ie.QueueItemCanStart=t=>e=>t.map(t=>{var n,r;return null===(r=null===(n=e[t])||void 0===n?void 0:n.done)||void 0===r||r}).every(t=>!0===t);class Re{constructor(t,e){this.id=t,this.dependencies=[],this.graph=e}addDependency(t){return this.dependencies.push(t),this}addWorkSpace(t){return this.workspace=t,this}addRunCallback(t){return this.runCallback||(this.runCallback=e=>t().then(t=>{e[this.id]={done:!0,success:t}}),this.graph.runSize++),this}}class Se extends Error{constructor(t){super(t),this.name="CyclicDependencyError",this.code="YN0003"}}const Ae="[";class Oe{static pad(t=1){for(let e=0;e<t;e++)process.stdout.write("\n");Oe.cursorUp(t)}static cursorUp(t=1){process.stdout.write(Ae+(t+"A"))}static cursorSave(){process.stdout.write("[s")}static cursorRestore(){process.stdout.write("[u")}static autoWrap(t){t?process.stdout.write("[?7h"):process.stdout.write("[?7l")}static clearScreenDown(){process.stdout.write("[J")}static async cursorPositionReport(){return new Promise(t=>{process.stdin.setRawMode(!0),process.stdin.once("data",e=>{process.stdin.setRawMode(!1),process.stdin.pause();const[n,r]=e.slice(2,e.length-1).toString().split(";").map(Number);t({x:r,y:n})}),process.stdout.write("[6n")})}static setScrollableRegion(t,e){process.stdout.write(`[${t};${e}r`)}static resetScrollableRegion(){process.stdout.write("[r")}static moveTo(t){process.stdout.write(`[${t.y};${t.x}H`)}static cursorHome(){process.stdout.write("[H")}static alternateScreen(){process.stdout.write("[?1049h")}static mainScreen(){process.stdout.write("[?1049l")}static linesRequired(t,e){var n;const r=new RegExp(`([^\n]{0,${e}})(\n)?`,"gm");return(null!==(n=_e()(t).match(r))&&void 0!==n?n:[""]).length-1}}Oe.row=0,Oe.column=0;const je=require("child_process");var Te=n(669);const $e=(0,Te.promisify)(je.exec),Me=async t=>{const e=(({platform:t,pid:e})=>{switch(t){case"unix":return`pgrep "-P ${e}"`;case"windows":return`wmic process where (ParentProcessId=${e}) get ProcessId`;default:throw new Error("Unable to find parent process")}})({platform:"win32"===process.platform?"windows":"unix",pid:t});let n=[];try{const{stdout:t}=await $e(e);n=t.split("\n").filter(Boolean).map(t=>parseInt(t,10)).filter(t=>!isNaN(t))}catch(t){}return n},Le={hasBeenTerminated:!1,callId:0},Ne=async(t=0)=>{if(t!==Le.callId)return;if(Le.hasBeenTerminated)return;const e=process.pid;(await Me(e)).forEach(t=>{try{process.kill(t,"SIGKILL")}catch(t){}});const n=Le.callId+1;Le.callId=n,setTimeout(async()=>{Ne(n)},50)},Pe="-".repeat(80);var De,Be;!function(t){t.pending="pending",t.skipped="skipped",t.inProgress="inProgress",t.failed="failed",t.succeeded="succeeded"}(De||(De={})),function(t){t.pending="pending",t.start="start",t.info="info",t.error="error",t.skipped="skipped",t.success="success",t.fail="fail",t.finish="finish",t.forceQuit="force-quit"}(Be||(Be={}));const Ue=async(t,e)=>{let n=0;const r=await a.xfs.readdirPromise(t);return await Promise.all(r.map(async r=>{const i=`${t}${l().sep}${r}`;if(e&&i.startsWith(e))return;const o=await a.xfs.statPromise(i);if(o.isFile()&&o.mtimeMs>n&&(n=o.mtimeMs),o.isDirectory()){const t=await Ue(i,e);t>n&&(n=t)}})),n},Fe=(t,e)=>{let n=Math.abs(e-t),r="";const i=Math.trunc(n/6e4);return i&&(r+=i+"m",n-=6e4*i),n&&(i&&(r+=" "),r+=(n/1e3).toFixed(2)+"s"),r};const qe=class{constructor({project:t,report:e,runCommand:n,cli:r,configuration:i,pluginConfiguration:s,dryRun:c,ignoreRunCache:u,verbose:l,concurrency:h,shouldBailInstantly:p}){this.runGraph=new Ie,this.runLength=0,this.runTargets=[],this.runMutexes={},this.dryRun=!1,this.ignoreRunCache=!1,this.verbose=!1,this.shouldBailInstantly=!1,this.entrypoints=[],this.runReporter=new ve.EventEmitter,this.runReport={mutex:new ke.W,totalJobs:0,skipCount:0,previousOutput:"",successCount:0,failCount:0,bail:!1,workspaces:{},done:!1},this.nextUnitOfWork=[],this.hasSetup=!1,this.setupRunReporter=()=>{this.runReporter.on(Be.pending,(t,e)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[t]={name:e,stdout:[],stderr:[],done:!1,fail:!1},n()})}),this.runReporter.on(Be.start,(t,e,n)=>{this.runReport.mutex.acquire().then(r=>{this.runReport.workspaces[t]={...this.runReport.workspaces[t],start:Date.now(),runScript:n,name:e},r()})}),this.runReporter.on(Be.info,(t,e)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[t].stdout.push(e),n()})}),this.runReporter.on(Be.error,(t,e)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[t].stderr.push(e),this.logError(`${t} ${e}`),n()})}),this.runReporter.on(Be.success,t=>{this.runReport.mutex.acquire().then(e=>{this.runReport.workspaces[t]={...this.runReport.workspaces[t],done:!0},this.runReport.successCount++,e()})}),this.runReporter.on(Be.skipped,t=>{this.runReport.mutex.acquire().then(e=>{this.runReport.workspaces[t].done=!0,this.runReport.workspaces[t].skipped=!0,this.runReport.skipCount++,e()})}),this.runReporter.on(Be.fail,(t,e)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[t].stderr.push(e),this.runReport.workspaces[t].done=!0,this.runReport.workspaces[t].fail=!0,this.runReport.failCount++,this.logError(`${t} ${e}`),n()})})},this.getDependenciesCount=async t=>{let e=0;for(const n of o.Manifest.hardDependencies)for(const r of t.manifest.getForScope(n).values()){null!==this.project.tryWorkspaceByDescriptor(r)&&(e+=1)}return e},this.plan=async t=>{var e,n,r,i,s;const a=this.runGraph.addNode(t.relativeCwd).addWorkSpace(t);let c=!1;this.runMutexes[t.relativeCwd]=new ke.W;for(const e of o.Manifest.hardDependencies)for(const n of t.manifest.getForScope(e).values()){const t=this.project.tryWorkspaceByDescriptor(n);if(null===t)continue;const e=this.runGraph.addNode(t.relativeCwd).addWorkSpace(t);a.addDependency(e);const r=await this.plan(t);let i=!1;t!==this.project.topLevelWorkspace&&(i=await this.checkIfRunIsRequired(t)),(i||r)&&(c=!0,e.addRunCallback(this.createRunItem(t)))}let u=!1;if(t!==this.project.topLevelWorkspace&&(u=await this.checkIfRunIsRequired(t)),this.runReporter.emit(Be.pending,t.relativeCwd),c||u)return this.runReporter.emit(Be.pending,t.relativeCwd,`${(null===(e=t.manifest.name)||void 0===e?void 0:e.scope)?`@${null===(n=t.manifest.name)||void 0===n?void 0:n.scope}/`:""}${null===(r=t.manifest.name)||void 0===r?void 0:r.name}`),a.addRunCallback(this.createRunItem(t)),!0;{const e=null===(i=this.runLog)||void 0===i?void 0:i.get(`${t.relativeCwd}#${this.runCommand}`);e&&(null===(s=this.runLog)||void 0===s||s.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:e.lastModified,status:De.succeeded,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}))}return!1},this.run=async()=>{var t,e;if(!1===this.hasSetup)throw new Error("RunSupervisor is not setup, you need to call await supervisor.setup()");if(this.runReport.runStart=Date.now(),this.dryRun||ge()||(Oe.pad(this.concurrency+3),this.raf(this.waitUntilDone)),this.dryRun)return!0;this.currentRunTarget=this.runTargets.length>1?"All":null!==(e=null===(t=this.runTargets[0])||void 0===t?void 0:t.relativeCwd)&&void 0!==e?e:"Nothing to run",ge()||process.stderr.write("\n");const n=this.generateHeaderString();await this.runGraph.run(this.entrypoints);const r=await this.runReport.mutex.acquire();if(this.runReport.done=!0,r(),ge()||(Oe.cursorUp(Oe.linesRequired(this.runReport.previousOutput,process.stdout.columns)),Oe.clearScreenDown()),0!==this.runReport.failCount){const t=[];process.stdout.write(this.formatHeader(n)+"\n");let e=!1;for(const n in this.runReport.workspaces){const r=this.runReport.workspaces[n];if(r.fail&&t.push(n),0!==r.stdout.length||0!==r.stderr.length){e=!0;const t=this.formatHeader("Output: "+o.formatUtils.pretty(this.configuration,n,o.FormatType.NAME),2);process.stdout.write(t+"\n")}if(0!==r.stdout.length&&(e=!0,r.stdout.forEach(t=>{t.split("\n").forEach(t=>{0!==t.length&&process.stdout.write(t+"\n")})})),0!==r.stderr.length){e=!0;const t="[stderr]";process.stderr.write(t+"\n"),r.stderr.forEach(t=>{(t instanceof Error?t.toString():""+t).split("\n").forEach(t=>{0!==t.length&&process.stderr.write(t+"\n")})})}}if(e&&process.stdout.write(this.grey(Pe)+"\n"),t.length>0){const e=this.grey(`ERROR for script ${n}\nThe following packages returned an error.\n`);process.stderr.write(e),t.forEach(t=>{const e="- "+o.formatUtils.pretty(this.configuration,t,o.FormatType.NAME);process.stderr.write(e+"\n")})}process.stderr.write(this.grey("Search `Output: path` to find the start of the output.\n"))}const i=this.generateFinalReport();return process.stdout.write(i),await this.saveRunLog(),0===this.runReport.failCount},this.raf=t=>{setImmediate(()=>t(Date.now()))},this.waitUntilDone=t=>{if(this.runReport.done)return;const e=this.generateProgressString(t);var n;Oe.cursorUp(Oe.linesRequired(this.runReport.previousOutput,process.stdout.columns)),Oe.clearScreenDown(),process.stdout.write(e),this.runReport.previousOutput=e,(n=90,new Promise(t=>setTimeout(t,n))).then(()=>{this.raf(this.waitUntilDone)})},this.grey=t=>o.formatUtils.pretty(this.configuration,t,"grey"),this.generateRunCountString=t=>{let e="";if(this.runReport.runStart){const n=o.formatUtils.pretty(this.configuration,""+this.runReport.successCount,"green"),r=o.formatUtils.pretty(this.configuration,""+this.runReport.failCount,"red"),i=o.formatUtils.pretty(this.configuration,""+this.runGraph.runSize,"white");e+=this.formatHeader(`${n}:${r}/${i} ${Fe(this.runReport.runStart,t)}`)+"\n"}return e},this.generateFinalReport=()=>{var t;const e=this.formatHeader(`${o.formatUtils.pretty(this.configuration,this.runCommand+" finished",0===this.runReport.failCount?"green":"red")}${0!=this.runReport.failCount?o.formatUtils.pretty(this.configuration,` with ${this.runReport.failCount} errors`,"red"):""}`)+"\n";let n=this.formatHeader("Summary")+"\n";if(this.runReport.runStart){const t=this.runReport.skipCount+(this.runReport.totalJobs-this.runReport.skipCount-this.runReport.failCount-this.runReport.successCount);n+=o.formatUtils.pretty(this.configuration,"Success: "+this.runReport.successCount,"green")+"\n"+o.formatUtils.pretty(this.configuration,"Fail: "+this.runReport.failCount,"red")+"\n"+o.formatUtils.pretty(this.configuration,"Skipped: "+t,"white")+"\n"+o.formatUtils.pretty(this.configuration,"Total: "+this.runReport.totalJobs,"white")+"\n"+this.grey("---")+"\n"}let r=50;for(const e in this.runReport.workspaces){r+=null!==(t=this.runReport.workspaces[e].runtimeSeconds)&&void 0!==t?t:0}if(this.runReport.runStart&&this.runGraph.runSize>1){const t=r,e=Date.now()-this.runReport.runStart,i=Fe(e,t);ge()||(n+=`Cumulative: (cpu): ${Fe(0,r)}\n`,n+=`Saved: ${i}\n`)}return this.runReport.runStart&&(n+="Runtime (wall): "+Fe(Date.now(),this.runReport.runStart)+"\n"),n+=e,n},this.createRunItem=t=>async()=>await this.limit(async()=>{var e,n,r,i,o,s,a,c,u;const l=t.relativeCwd,h=t.manifest.scripts.get(this.runCommand),p=null===(e=this.runLog)||void 0===e?void 0:e.get(`${t.relativeCwd}#${this.runCommand}`);if(this.runReporter.emit(Be.start,t.relativeCwd,`${(null===(n=t.manifest.name)||void 0===n?void 0:n.scope)?`@${null===(r=t.manifest.name)||void 0===r?void 0:r.scope}/`:""}${null===(i=t.manifest.name)||void 0===i?void 0:i.name}`,h),!h)return this.verbose&&this.runReporter.emit(Be.info,t.relativeCwd,`Missing \`${this.runCommand}\` script in manifest.`),this.runReporter.emit(Be.success,t.relativeCwd),!0;try{if(this.runReport.bail)return this.runReporter.emit(Be.skipped,t.relativeCwd),null===(o=this.runLog)||void 0===o||o.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:null==p?void 0:p.lastModified,status:De.skipped,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),!1;const e=await this.cli(this.runCommand,t.cwd,this.runReporter,l);if(0!==e)return this.shouldBailInstantly&&this.runReport.bail&&e>100?(this.runReporter.emit(Be.skipped,t.relativeCwd),null===(s=this.runLog)||void 0===s||s.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:null==p?void 0:p.lastModified,status:De.skipped,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),!1):(this.runReporter.emit(Be.fail,t.relativeCwd),null===(a=this.runLog)||void 0===a||a.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:null==p?void 0:p.lastModified,status:De.failed,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),this.shouldBailInstantly&&!this.runReport.bail&&(this.runReport.bail=!0,Ne()),!1);null===(c=this.runLog)||void 0===c||c.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:null==p?void 0:p.lastModified,status:De.succeeded,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),this.runReporter.emit(Be.success,t.relativeCwd)}catch(e){return this.runReporter.emit(Be.fail,t.relativeCwd,e),null===(u=this.runLog)||void 0===u||u.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:null==p?void 0:p.lastModified,status:De.failed,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),!1}return!0});const d=null!=h?h:Math.max(1,(0,me.cpus)().length);this.configuration=i,this.pluginConfiguration=s,this.project=t,this.report=e,this.runCommand=n,this.cli=r,this.dryRun=c,this.ignoreRunCache=u,this.verbose=l,this.concurrency=d,this.shouldBailInstantly=null!=p?p:this.shouldBailInstantly,this.limit=we()(d),this.queue=new ye.Z({concurrency:d,carryoverConcurrencyCount:!0,timeout:5e4,throwOnTimeout:!0,autoStart:!0}),this.verbose&&(this.errorLogFile=a.xfs.createWriteStream(this.getRunErrorPath(),{flags:"a"}))}async setup(){this.runLog=await this.readRunLog(),this.setupRunReporter(),this.hasSetup=!0}getRunErrorPath(){return a.ppath.resolve(this.project.cwd,"yarn.build-error.log")}getRunLogPath(){return a.ppath.resolve(this.project.cwd,".yarn","yarn.build.json")}async readRunLog(){const t=new Map;try{const e=await a.xfs.readJsonPromise(this.getRunLogPath());if(e&&e.packages)for(const n in e.packages)t.set(n,{lastModified:e.packages[n].lastModified,status:e.packages[n].status,haveCheckedForRerun:!1,rerun:!0,command:this.runCommand})}catch(t){}return t}async saveRunLog(){if(!this.runLog)return;let t;try{t=await a.xfs.readJsonPromise(this.getRunLogPath())}catch(t){}const e={comment:"This is an auto-generated file, it keeps track of whats been built. This is a local file, don't store this in version control.",packages:{...t&&t.packages}};for(const[t,n]of this.runLog)n.status===De.succeeded&&(e.packages[t]={...e.packages[t],...this.runLog.get(t)});await a.xfs.writeJsonPromise(this.getRunLogPath(),e)}logError(t){this.verbose&&process.stderr.write(_e()(t)+"\n")}async addRunTarget(t,e=!1){this.entrypoints.push(this.runGraph.addNode(t.relativeCwd));const n=await this.plan(t);if(e){const e=1+await this.getDependenciesCount(t);this.runReport.totalJobs=e}n&&this.runTargets.push(t)}async checkIfRunIsRequired(t){var e,n,r,i,o;if(!0===this.ignoreRunCache)return!0;let s=!1;const c=a.ppath.resolve(t.project.cwd,t.relativeCwd);let u,h;(null===(e=null==t?void 0:t.manifest)||void 0===e?void 0:e.raw["yarn.build"])&&"string"==typeof(null==t?void 0:t.manifest.raw["yarn.build"].output)?u=`${c}${l().sep}${null==t?void 0:t.manifest.raw["yarn.build"].output}`:this.pluginConfiguration.folders.output?u=`${c}${l().sep}${this.pluginConfiguration.folders.output}`:(null==t?void 0:t.manifest.raw.main)&&(u=`${c}${l().sep}${null==t?void 0:t.manifest.raw.main.substring(0,null==t?void 0:t.manifest.raw.main.lastIndexOf(l().sep))}`),(null===(n=null==t?void 0:t.manifest)||void 0===n?void 0:n.raw["yarn.build"])&&"string"==typeof(null==t?void 0:t.manifest.raw["yarn.build"].input)?h=`${c}${l().sep}${null==t?void 0:t.manifest.raw["yarn.build"].input}`:this.pluginConfiguration.folders.input&&(h=`${c}${l().sep}${this.pluginConfiguration.folders.input}`),(null==h?void 0:h.endsWith("/."))&&(h=h.substring(0,h.length-2));const p=await this.runReport.mutex.acquire();try{const e=null===(r=this.runLog)||void 0===r?void 0:r.get(`${t.relativeCwd}#${this.runCommand}`);if(null==e?void 0:e.haveCheckedForRerun)return null===(i=null==e?void 0:e.rerun)||void 0===i||i;const n=await Ue(null!=h?h:c,u);(null==e?void 0:e.lastModified)!==n&&(s=!0),null===(o=this.runLog)||void 0===o||o.set(`${t.relativeCwd}#${this.runCommand}`,{lastModified:n,status:s?De.succeeded:De.pending,haveCheckedForRerun:!0,rerun:s,command:this.runCommand})}catch(e){this.logError(`${t.relativeCwd}: failed to get lastModified (${e})`)}finally{p()}return s}formatHeader(t,e=0){const n=`${this.grey("-".repeat(e)+"[")} ${t} ${this.grey("]")}`,r=_e()(n).length;return n+this.grey("-".repeat(80-r))}generateHeaderString(){return`${o.formatUtils.pretty(this.configuration,""+this.runCommand,o.FormatType.CODE)} for ${o.formatUtils.pretty(this.configuration,this.currentRunTarget?this.currentRunTarget:"",o.FormatType.SCOPE)}${this.dryRun?o.formatUtils.pretty(this.configuration," --dry-run",o.FormatType.NAME):""}`}generateProgressString(t){let e="";const n=t=>this.grey(`[${t}]`),r=o.formatUtils.pretty(this.configuration,"IDLE","grey");e+=this.formatHeader(this.generateHeaderString())+"\n";let i=1;for(const r in this.runReport.workspaces){const s=this.runReport.workspaces[r];if(!s||!s.start||s.done)continue;this.runReport.runStart&&(this.runReport.workspaces[r].runtimeSeconds=t-this.runReport.runStart);const a=o.formatUtils.pretty(this.configuration,r,o.FormatType.NAME),c=o.formatUtils.pretty(this.configuration,`(${s.runScript})`,o.FormatType.REFERENCE),u=s.start?o.formatUtils.pretty(this.configuration,Fe(s.start,t),o.FormatType.RANGE):"",l=n(i++),h=" ".repeat(l.length-1),p=o.formatUtils.pretty(this.configuration,s.name,o.FormatType.NAME);let d=`${l} ${a}${p} ${c} ${u}\n`,f="",g="",m="";_e()(d).length>=process.stdout.columns&&(f=`${l} ${a}${p}\n`,g=`${h} ${c} ${u}\n`,_e()(f).length>=process.stdout.columns&&(f=Ee()(`${l} ${a}\n`,0,process.stdout.columns),g=Ee()(`${h} ${p}\n`,0,process.stdout.columns),m=Ee()(`${h} ${c} ${u}\n`,0,process.stdout.columns)),d=f+g+m),e+=d}for(;i<this.concurrency+1;)e+=`${n(i++)} ${r}\n`;return this.runReport.runStart&&(e+=this.generateRunCountString(t)),e}},Ge=(t,e)=>{const n=[];for(const r of t.workspacesCwds){const t=e.workspacesByCwd.get(r);t&&n.push(t,...Ge(t,e))}return n},ze=async({targetWorkspace:t,project:e,supervisor:n})=>{if(0!==t.workspacesCwds.size){const r=Ge(t,e);n.runReport.totalJobs=r.length;for(const t of r){for(const r of o.Manifest.hardDependencies)for(const i of t.manifest.getForScope(r).values()){const t=e.tryWorkspaceByDescriptor(i);null!==t&&await n.addRunTarget(t)}await n.addRunTarget(t)}await n.addRunTarget(t)}else await n.addRunTarget(t,!0)};class We extends t.BaseCommand{constructor(){super(...arguments),this.json=c.Option.Boolean("--json",!1,{description:"flag is set the output will follow a JSON-stream output\n      also known as NDJSON (https://github.com/ndjson/ndjson-spec)."}),this.buildCommand=c.Option.String("-c,--build-command","build",{description:'the command to be run in each package (if available), defaults to "build"'}),this.interlaced=c.Option.Boolean("-i,--interlaced",!0,{description:"If false it will instead buffer the output from each process and print the resulting buffers only after their source processes have exited. Defaults to false."}),this.verbose=c.Option.Boolean("-v,--verbose",!1,{description:"more information will be logged to stdout than normal."}),this.dryRun=c.Option.Boolean("-d,--dry-run",!1,{description:"simulate running a build, but not actually run it"}),this.ignoreBuildCache=c.Option.Boolean("--ignore-cache",!1,{description:"every package will be built, regardless of whether is has changed or not."}),this.maxConcurrency=c.Option.String("-m,--max-concurrency",{description:"is the maximum number of builds that can run at a time, defaults to the number of logical CPUs on the current machine. Will override the global config option."}),this.shouldBailInstantly=c.Option.Boolean("--bail",!1,{description:"exit immediately upon build failing"}),this.buildTarget=c.Option.Rest(),this.forceQuit=!1,this.buildLog={}}async execute(){var t,e;const n=await o.Configuration.find(this.context.cwd,this.context.plugins),r=await he(n);this.shouldBailInstantly=null!==(t=this.shouldBailInstantly)&&void 0!==t?t:r.bail,this.shouldBailInstantly=null!==(e=this.shouldBailInstantly)&&void 0!==e?e:r.bail;const i=void 0===this.maxConcurrency?r.maxConcurrency:parseInt(this.maxConcurrency),s=await o.StreamReport.start({configuration:n,json:this.json,stdout:this.context.stdout,includeLogs:!0},async t=>{let e=this.context.cwd;"string"==typeof this.buildTarget[0]&&(e=`${n.projectCwd}${l().sep}${this.buildTarget[0]}`);const{project:s,workspace:a}=await o.Project.find(n,e),c=a||s.topLevelWorkspace,u=new qe({project:s,configuration:n,pluginConfiguration:r,report:t,runCommand:this.buildCommand,cli:async(t,e,n,r)=>{const i=new o.miscUtils.BufferStream;i.on("data",t=>null==n?void 0:n.emit(Be.info,r,t&&t.toString()));const s=new o.miscUtils.BufferStream;if(s.on("data",t=>null==n?void 0:n.emit(Be.error,r,t&&t.toString())),this.forceQuit)return i.destroy(),s.destroy(),i.end(),s.end(),2;try{const n=await this.cli.run(["run",t],{cwd:e,stdout:i,stderr:s})||0;return i.end(),s.end(),n}catch(t){i.end(),s.end()}return 2},dryRun:this.dryRun,ignoreRunCache:this.ignoreBuildCache,verbose:this.verbose,concurrency:i,shouldBailInstantly:this.shouldBailInstantly});u.runReporter.on(Be.forceQuit,()=>{this.forceQuit=!0}),await u.setup(),await ze({targetWorkspace:c,project:s,supervisor:u});!1===await u.run()&&t.reportError(o.MessageName.BUILD_FAILED,"Build failed")});return Le.hasBeenTerminated=!0,s.exitCode()}}We.paths=[["build"]],We.usage=c.Command.Usage({category:"Build commands",description:"build a package and all its dependencies",details:"\n      In a monorepo with internal packages that depend on others, this command\n      will traverse the dependency graph and efficiently ensure, the packages\n      are built in the right order.\n\n    "});const Qe=t=>{if(null==t)throw new Error("Invalid name");return t.scope?`@${t.scope}/${t.name}`:t.name},Ye={firstCharacters:"➤ ",tabString:"│ "},Je=({format:t,padding:e,step:n=5,characters:r=Ye})=>{const{firstCharacters:i,tabString:o}=r,s=o.split("");for(let r=0;r<e;r++){const e=Array(n).fill(" ").map((t,e)=>e<s.length?s[e]:t).join("");process.stdout.write(t(e,"gray"))}process.stdout.write(t(i,"gray"))},He=o.FormatType.NAME,Ze=({format:t,circular:e,dependency:n,parents:r,current:i,project:o,padding:s=0})=>{if(e)return Je({format:t,padding:s+1}),process.stdout.write(t(n,He)),process.stdout.write(t(" -> circular dependency","red")),void process.stdout.write("\n");const a=(({project:t,workspaceName:e})=>t.workspaces.find(t=>Qe(t.manifest.name)===e))({project:o,workspaceName:n});if(!a)return Je({format:t,padding:s+1}),process.stdout.write(n),process.stdout.write(t("-> incorrect dependency","red")),void process.stdout.write("\n");Xe({format:t,project:o,parent:i,parents:[...r,i],padding:s+1,workspace:a})},Ke=({format:t,workspace:e,parent:n,parents:r,project:i,padding:o=0})=>{const s=(({workspace:t,project:e})=>{const n=Array.from(t.manifest.dependencies.values()).map(t=>Qe(t)),r=Array.from(e.workspaces.values()).map(t=>Qe(t.manifest.name));return n.filter(t=>r.includes(t))})({workspace:e,project:i});for(const a of s)Ze({format:t,workspace:e,project:i,padding:o,parent:n,parents:r,current:Qe(e.manifest.name),circular:n===a||r.includes(a),dependency:a})},Ve=o.FormatType.NAME,Xe=({format:t,workspace:e,project:n,parents:r,padding:i=0,parent:o})=>{(({format:t,workspace:e,padding:n=0})=>{const{name:r}=e.manifest,i=Qe(r);Je({format:t,padding:n}),process.stdout.write(t(i,Ve)),process.stdout.write("\n")})({workspace:e,padding:i,format:t}),Ke({parents:r,workspace:e,project:n,padding:i,parent:o,format:t})},tn=({padding:t})=>{for(let e=0;e<t;e++)process.stdout.write("\n")};class en extends t.BaseCommand{async execute(){const t=await o.Configuration.find(this.context.cwd,this.context.plugins),{project:e,workspace:n}=await o.Project.find(t,this.context.cwd);if(!n)return 0;const r=(e,n)=>o.formatUtils.pretty(t,e,n);return tn({padding:1}),(({workspace:t,format:e})=>{const n=Qe(t.manifest.name);process.stdout.write("Build query for package: "+e(n,"bold")),tn({padding:1})})({workspace:n,format:r}),Xe({parents:[],workspace:n,project:e,format:r}),tn({padding:2}),0}}en.paths=[["build","query"]],en.usage=c.Command.Usage({category:"Build commands",description:"prints out dependency graph for current package",details:"\n          In a monorepo with internal packages that depend on others, this command\n          will traverse the dependency graph and efficiently ensure, the packages\n          are built in the right order.\n    \n        "});class nn extends t.BaseCommand{constructor(){super(...arguments),this.json=c.Option.Boolean("--json",!1,{description:"flag is set the output will follow a JSON-stream output\n      also known as NDJSON (https://github.com/ndjson/ndjson-spec)."}),this.verbose=c.Option.Boolean("-v,--verbose",!1,{description:"more information will be logged to stdout than normal."}),this.ignoreTestCache=c.Option.Boolean("--ignore-cache",!1,{description:"every package will be tested, regardless of whether is has changed or not."}),this.maxConcurrency=c.Option.String("-m,--max-concurrency",{description:"is the maximum number of tests that can run at a time, defaults to the number of logical CPUs on the current machine. Will override the global config option."}),this.shouldBailInstantly=c.Option.Boolean("--bail",!1,{description:"exit immediately upon build failing"}),this.runTarget=c.Option.Rest(),this.forceQuit=!1,this.runLog={}}async execute(){var t;const e=await o.Configuration.find(this.context.cwd,this.context.plugins),n=await he(e);this.shouldBailInstantly=null!==(t=this.shouldBailInstantly)&&void 0!==t?t:n.bail;const r=void 0===this.maxConcurrency?n.maxConcurrency:parseInt(this.maxConcurrency),i=await o.StreamReport.start({configuration:e,json:this.json,stdout:this.context.stdout,includeLogs:!0},async t=>{let i=this.context.cwd;"string"==typeof this.runTarget[0]&&(i=`${e.projectCwd}${l().sep}${this.runTarget[0]}`);const{project:s,workspace:a}=await o.Project.find(e,i),c=a||s.topLevelWorkspace,u=new qe({project:s,configuration:e,pluginConfiguration:n,report:t,runCommand:"test",cli:async(t,e,n,r)=>{const i=new o.miscUtils.BufferStream;i.on("data",t=>null==n?void 0:n.emit(Be.info,r,t&&t.toString()));const s=new o.miscUtils.BufferStream;if(s.on("data",t=>null==n?void 0:n.emit(Be.error,r,t&&t.toString())),this.forceQuit)return i.destroy(),s.destroy(),i.end(),s.end(),2;try{const n=await this.cli.run(["run",t],{cwd:e,stdout:i,stderr:s})||0;return i.end(),s.end(),n}catch(t){i.end(),s.end()}return 2},dryRun:!1,ignoreRunCache:this.ignoreTestCache,verbose:this.verbose,concurrency:r,shouldBailInstantly:this.shouldBailInstantly});u.runReporter.on(Be.forceQuit,()=>{this.forceQuit=!0}),await u.setup(),await ze({targetWorkspace:c,project:s,supervisor:u});!1===await u.run()&&t.reportError(o.MessageName.BUILD_FAILED,"Test failed")});return Le.hasBeenTerminated=!0,i.exitCode()}}nn.paths=[["test"]],nn.usage=c.Command.Usage({category:"Test commands",description:"test a package and all its dependencies",details:"\n    In a monorepo with internal packages that depend on others, this command\n    will traverse the dependency graph and efficiently ensure, the packages\n    are tested in the right order.\n    "});const rn={commands:[pe,en,We,nn]}})(),plugin=r})();
return plugin;
}
};